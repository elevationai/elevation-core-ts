var ElevationCore=(()=>{var vr=Object.defineProperty;var ye=Object.getOwnPropertyDescriptor;var Ie=Object.getOwnPropertyNames;var Oe=Object.prototype.hasOwnProperty;var Ae=(o=>typeof require<"u"?require:typeof Proxy<"u"?new Proxy(o,{get:(r,e)=>(typeof require<"u"?require:r)[e]}):o)(function(o){if(typeof require<"u")return require.apply(this,arguments);throw Error('Dynamic require of "'+o+'" is not supported')});var Se=(o,r)=>{for(var e in r)vr(o,e,{get:r[e],enumerable:!0})},Te=(o,r,e,n)=>{if(r&&typeof r=="object"||typeof r=="function")for(let i of Ie(r))!Oe.call(o,i)&&i!==e&&vr(o,i,{get:()=>r[i],enumerable:!(n=ye(r,i))||n.enumerable});return o};var Re=o=>Te(vr({},"__esModule",{value:!0}),o);var We={};Se(We,{CMS:()=>Z,Cache:()=>rr,Debouncer:()=>k,ElevatedConfigurations:()=>X,ElevatedEnrollment:()=>z,ElevatedEvents:()=>V,ElevatedIOT:()=>Y,ElevatedLogs:()=>W,ElevationService:()=>$r,EventCode:()=>qr,EventMode:()=>Yr,EventType:()=>zr,LogLevel:()=>Pr,StatusCode:()=>Dr,TouchPoint:()=>J,cms:()=>wr,elevatedConfigurations:()=>Rr,elogs:()=>tr,enrollment:()=>Tr,events:()=>er,iot:()=>Sr,touchPoint:()=>Nr,uuid:()=>Xr});var qr=(t=>(t[t.PNR_RETRIEVAL=1]="PNR_RETRIEVAL",t[t.BAGTAG_PRINT=2]="BAGTAG_PRINT",t[t.PAPER_LOW=3]="PAPER_LOW",t[t.PAPER_OUT=4]="PAPER_OUT",t[t.UPPER_DOOR_OPEN=5]="UPPER_DOOR_OPEN",t[t.UPPER_DOOR_CLOSED=6]="UPPER_DOOR_CLOSED",t[t.LOWER_DOOR_OPEN=7]="LOWER_DOOR_OPEN",t[t.LOWER_DOOR_CLOSED=8]="LOWER_DOOR_CLOSED",t[t.PASS_SCANNED=9]="PASS_SCANNED",t[t.ONLINE=10]="ONLINE",t[t.OFFLINE=11]="OFFLINE",t[t.IN_SERVICE=12]="IN_SERVICE",t[t.OUT_OF_SERVICE=13]="OUT_OF_SERVICE",t[t.PAPER_JAM=14]="PAPER_JAM",t[t.TOO_LATE_FOR_FLIGHT=15]="TOO_LATE_FOR_FLIGHT",t[t.TOO_EARLY_FOR_FLIGHT=16]="TOO_EARLY_FOR_FLIGHT",t[t.INCORRECT_LOCATION=17]="INCORRECT_LOCATION",t[t.RESERVATION_NOT_FOUND=18]="RESERVATION_NOT_FOUND",t[t.BOARDING_PASS_INVALID=19]="BOARDING_PASS_INVALID",t[t.NOT_CHECKED_IN=120]="NOT_CHECKED_IN",t[t.INELIGIBLE=121]="INELIGIBLE",t[t.INTERNATIONAL=122]="INTERNATIONAL",t[t.PREVIOUSLY_PRINTED=123]="PREVIOUSLY_PRINTED",t[t.NO_BAGS=64]="NO_BAGS",t[t.WRONG_AIRLINE=65]="WRONG_AIRLINE",t[t.PRINTER_FAILURE=66]="PRINTER_FAILURE",t[t.UNAUTHORIZED_CROSSING_ENTRANCE=20]="UNAUTHORIZED_CROSSING_ENTRANCE",t[t.UNAUTHORIZED_CROSSING_EXIT=21]="UNAUTHORIZED_CROSSING_EXIT",t[t.FRAUD_CRAWLING=22]="FRAUD_CRAWLING",t[t.FRAUD_JUMP=23]="FRAUD_JUMP",t[t.UNAUTHORIZED_STANDING_AT_ENTRANCE=24]="UNAUTHORIZED_STANDING_AT_ENTRANCE",t[t.UNAUTHORIZED_STANDING_AT_EXIT=25]="UNAUTHORIZED_STANDING_AT_EXIT",t[t.STOP_IN_GATE=26]="STOP_IN_GATE",t[t.ONE_BOARD_ONE_LEFT_ENTRANCE=27]="ONE_BOARD_ONE_LEFT_ENTRANCE",t[t.TWO_BOARDED=28]="TWO_BOARDED",t[t.ONE_BOARDED_ONE_CROSSED=29]="ONE_BOARDED_ONE_CROSSED",t[t.ONE_CROSSED_LEFT_ENTRANCE=30]="ONE_CROSSED_LEFT_ENTRANCE",t[t.ONE_BOARDED_THEN_LEFT_VIA_ENTRANCE=31]="ONE_BOARDED_THEN_LEFT_VIA_ENTRANCE",t[t.BOARDED_WITHOUT_AUTHORIZATION=32]="BOARDED_WITHOUT_AUTHORIZATION",t[t.CROSSING_ENTRANCE_TIMEOUT=33]="CROSSING_ENTRANCE_TIMEOUT",t[t.CROSSING_EXIT_TIMEOUT=34]="CROSSING_EXIT_TIMEOUT",t[t.EXIT_NOT_CLEARED_TIMEOUT=35]="EXIT_NOT_CLEARED_TIMEOUT",t[t.GATE_ENTRY_TIMEOUT=36]="GATE_ENTRY_TIMEOUT",t[t.GATE_CROSSING_TIMEOUT=37]="GATE_CROSSING_TIMEOUT",t[t.MANTRAP_VALIDATION_TIMEOUT=38]="MANTRAP_VALIDATION_TIMEOUT",t[t.EXIT_AREA_CLEAR=39]="EXIT_AREA_CLEAR",t[t.EXIT_AREA_OCCUPIED=40]="EXIT_AREA_OCCUPIED",t[t.SELF_BOARDING_COMPLETE=41]="SELF_BOARDING_COMPLETE",t[t.NO_PASS_FIRST_SENSOR=42]="NO_PASS_FIRST_SENSOR",t[t.NO_PASS_LAST_SENSOR=43]="NO_PASS_LAST_SENSOR",t[t.BOARDING_CANCELED=44]="BOARDING_CANCELED",t[t.SENSOR_FAILURE=45]="SENSOR_FAILURE",t[t.FLAPS_FAILURE=46]="FLAPS_FAILURE",t[t.PAPER_RESTOCK=47]="PAPER_RESTOCK",t[t.SESSION_TIME=48]="SESSION_TIME",t[t.ALARM=49]="ALARM",t[t.EXIT_BLOCKED=50]="EXIT_BLOCKED",t[t.INCORRECT_GATE=51]="INCORRECT_GATE",t[t.GATE_OPEN=52]="GATE_OPEN",t[t.GATE_CLOSED=53]="GATE_CLOSED",t[t.GATE_AUTHORIZED=54]="GATE_AUTHORIZED",t[t.EMERGENCY=55]="EMERGENCY",t[t.MAINTENANCE=56]="MAINTENANCE",t[t.BOARDING_PASS_PREVIOUSLY_USED=57]="BOARDING_PASS_PREVIOUSLY_USED",t[t.GATE_INOPERABLE=58]="GATE_INOPERABLE",t[t.GATE_EMPLOYEE_AUTHORIZED=59]="GATE_EMPLOYEE_AUTHORIZED",t[t.FREESTATE=60]="FREESTATE",t[t.CONTROLSTATE=61]="CONTROLSTATE",t[t.PRMMODE=62]="PRMMODE",t[t.AIRLINE_PASS=63]="AIRLINE_PASS",t[t.BOARDING_PASS_PRINT=68]="BOARDING_PASS_PRINT",t[t.APPLICATION_AVAILABLE=69]="APPLICATION_AVAILABLE",t[t.APPLICATION_UNAVAILABLE=70]="APPLICATION_UNAVAILABLE",t[t.APPLICATION_ACTIVE=71]="APPLICATION_ACTIVE",t[t.APPLICATION_STOP=72]="APPLICATION_STOP",t[t.PASSPORT_SCANNED=73]="PASSPORT_SCANNED",t[t.BAGTAG_PRINTER_ONLINE=74]="BAGTAG_PRINTER_ONLINE",t[t.BAGTAG_PRINTER_OFFLINE=75]="BAGTAG_PRINTER_OFFLINE",t[t.BARCODE_READER_ONLINE=76]="BARCODE_READER_ONLINE",t[t.BARCODE_READER_OFFLINE=77]="BARCODE_READER_OFFLINE",t[t.PASSPORT_READER_ONLINE=78]="PASSPORT_READER_ONLINE",t[t.PASSPORT_READER_OFFLINE=79]="PASSPORT_READER_OFFLINE",t[t.BOARDINGPASS_PRINTER_ONLINE=90]="BOARDINGPASS_PRINTER_ONLINE",t[t.BOARDINGPASS_PRINTER_OFFLINE=91]="BOARDINGPASS_PRINTER_OFFLINE",t[t.BOARDINGPASS_PRINTER_PAPER_OUT=92]="BOARDINGPASS_PRINTER_PAPER_OUT",t[t.BOARDINGPASS_PRINTER_PAPER_LOW=93]="BOARDINGPASS_PRINTER_PAPER_LOW",t[t.BOARDINGPASS_PRINTER_PAPER_JAM=94]="BOARDINGPASS_PRINTER_PAPER_JAM",t[t.BOARDINGPASS_PRINTER_PAPER_RESTOCK=95]="BOARDINGPASS_PRINTER_PAPER_RESTOCK",t[t.BOARDINGPASS_PRINTER_FAILURE=96]="BOARDINGPASS_PRINTER_FAILURE",t[t.CONFIGURATION_REQUESTED=103]="CONFIGURATION_REQUESTED",t[t.CONFIGURATION_COMPLETED=110]="CONFIGURATION_COMPLETED",t[t.PASSENGER_CHECK_IN=104]="PASSENGER_CHECK_IN",t[t.PASSENGER_CHECK_IN_FAILED=105]="PASSENGER_CHECK_IN_FAILED",t[t.BAGTAG_PRINT_FAILURE=106]="BAGTAG_PRINT_FAILURE",t[t.APPLICATION_ACTIVE_ACCESSIBLE=108]="APPLICATION_ACTIVE_ACCESSIBLE",t[t.APPLICATION_INITIALIZE=109]="APPLICATION_INITIALIZE",t[t.CARDREADER_ONLINE=111]="CARDREADER_ONLINE",t[t.CARDREADER_OFFLINE=112]="CARDREADER_OFFLINE",t[t.CARDREADER_FAILURE=113]="CARDREADER_FAILURE",t[t.CARDREADER_READ=114]="CARDREADER_READ",t[t.ANNOUNCEMENT_ONLINE=115]="ANNOUNCEMENT_ONLINE",t[t.ANNOUNCEMENT_OFFLINE=116]="ANNOUNCEMENT_OFFLINE",t[t.KEYPAD_ONLINE=117]="KEYPAD_ONLINE",t[t.KEYPAD_OFFLINE=118]="KEYPAD_OFFLINE",t[t.ILLUMINATION_ONLINE=119]="ILLUMINATION_ONLINE",t[t.ILLUMINATION_OFFLINE=124]="ILLUMINATION_OFFLINE",t[t.HEADSET_ONLINE=125]="HEADSET_ONLINE",t[t.HEADSET_OFFLINE=126]="HEADSET_OFFLINE",t[t.FEEDER_ONLINE=127]="FEEDER_ONLINE",t[t.FEEDER_OFFLINE=128]="FEEDER_OFFLINE",t[t.DISPENSER_ONLINE=129]="DISPENSER_ONLINE",t[t.DISPENSER_OFFLINE=130]="DISPENSER_OFFLINE",t[t.NO_DOCV=131]="NO_DOCV",t[t.DOCS_VERIFIED_PRINTING_ALLOWED=132]="DOCS_VERIFIED_PRINTING_ALLOWED",t[t.GROUP_BOOKING_NOT_SUPPORTED=135]="GROUP_BOOKING_NOT_SUPPORTED",t[t.ERROR_GENERIC=400]="ERROR_GENERIC",t[t.USER_LOGIN=107]="USER_LOGIN",t[t.TEST_ENV=215]="TEST_ENV",t[t.AGENT_LOGIN_ACTIVATION=200]="AGENT_LOGIN_ACTIVATION",t[t.AGENT_LOGOUT_ACTIVATION=201]="AGENT_LOGOUT_ACTIVATION",t[t.PAX_ACTIVATION_TIME=202]="PAX_ACTIVATION_TIME",t[t.BAG_TAG_NOT_FOUND=204]="BAG_TAG_NOT_FOUND",t[t.EXPIRED_DRIVERS_LICENSE=205]="EXPIRED_DRIVERS_LICENSE",t[t.VALID_DRIVERS_LICENSE=206]="VALID_DRIVERS_LICENSE",t[t.NOT_PART_OF_RESERVATION=207]="NOT_PART_OF_RESERVATION",t[t.ID_MATCH_NOT_FOUND=208]="ID_MATCH_NOT_FOUND",t[t.BAG_ALREADY_ACTIVATED=209]="BAG_ALREADY_ACTIVATED",t[t.UNABLE_TO_ACTIVATE_BAG=210]="UNABLE_TO_ACTIVATE_BAG",t[t.INVALID_BAGTAG=216]="INVALID_BAGTAG",t[t.BOARDED=211]="BOARDED",t[t.BEGIN_BOARDING_FAILED=212]="BEGIN_BOARDING_FAILED",t[t.BOARDING_ENDED=213]="BOARDING_ENDED",t[t.BOARDING_FAILED=214]="BOARDING_FAILED",t[t.INVALID_BOARDING_PASS=217]="INVALID_BOARDING_PASS",t[t.FLIGHT_SCANNED_MISMATCH=218]="FLIGHT_SCANNED_MISMATCH",t[t.SCANNED_WITHOUT_STARTING=219]="SCANNED_WITHOUT_STARTING",t[t.BOARDING_STARTED=220]="BOARDING_STARTED",t[t.ZONING_ATTEMPT_FAILED=221]="ZONING_ATTEMPT_FAILED",t[t.ZONING_CHNAGE=222]="ZONING_CHNAGE",t[t.ZONING_TIME=223]="ZONING_TIME",t[t.FLIGHT_ROOM_JOINED=224]="FLIGHT_ROOM_JOINED",t[t.FLIGHT_ROOM_LEFT=225]="FLIGHT_ROOM_LEFT",t[t.MANIFEST_SUCCESS=226]="MANIFEST_SUCCESS",t[t.MANIFEST_ERROR=227]="MANIFEST_ERROR",t[t.SOCKET_COMMAND=228]="SOCKET_COMMAND",t[t.REQUEST_PROFILING=203]="REQUEST_PROFILING",t[t.FAILED_TO_READ_BAG_TAG=300]="FAILED_TO_READ_BAG_TAG",t[t.BAG_TAG_FOUND=301]="BAG_TAG_FOUND",t[t.BAG_SETTLED=302]="BAG_SETTLED",t[t.BAG_AT_ENTRY=303]="BAG_AT_ENTRY",t[t.BAG_IN_HOLDING_AREA=304]="BAG_IN_HOLDING_AREA",t[t.WAITING_ON_BHS=305]="WAITING_ON_BHS",t[t.INTRUSION_DETECTED=306]="INTRUSION_DETECTED",t[t.NO_BAG_DETECTED=307]="NO_BAG_DETECTED",t[t.TRYING_TO_ACQUIRE_BAG_TAG=308]="TRYING_TO_ACQUIRE_BAG_TAG",t[t.BAG_RELEASED=309]="BAG_RELEASED",t[t.MOVE_TO_HOLDING_AREA=310]="MOVE_TO_HOLDING_AREA",t[t.CANCEL_NEED_INTERVENTION=311]="CANCEL_NEED_INTERVENTION",t[t.CANCEL_PASSENGER_CAN_FIX=312]="CANCEL_PASSENGER_CAN_FIX",t[t.MULTIPLE_BAG_TAGS_ERROR=313]="MULTIPLE_BAG_TAGS_ERROR",t[t.MULTIPLE_BAGS_ERROR=314]="MULTIPLE_BAGS_ERROR",t[t.HOLDING_AREA_FULL=315]="HOLDING_AREA_FULL",t[t.BAG_CANNOT_RELEASE=316]="BAG_CANNOT_RELEASE",t[t.BAG_CANNOT_PROCESS=317]="BAG_CANNOT_PROCESS",t[t.CONVEY_BELT_INOPERABLE=318]="CONVEY_BELT_INOPERABLE",t[t.UNKNOWN_SBD_ERROR=319]="UNKNOWN_SBD_ERROR",t[t.BAG_OVER_LENGTH=320]="BAG_OVER_LENGTH",t[t.BAG_OVER_HEIGHT=321]="BAG_OVER_HEIGHT",t[t.BAG_JAMMED_INSIDE=322]="BAG_JAMMED_INSIDE",t[t.UNEXPECTED_BAG_IN_REAR=323]="UNEXPECTED_BAG_IN_REAR",t[t.BAG_TOO_FLAT=324]="BAG_TOO_FLAT",t[t.BAG_TOO_SHORT=325]="BAG_TOO_SHORT",t[t.BAG_OVERWEIGHT=326]="BAG_OVERWEIGHT",t[t.BAG_UNDERWEIGHT=327]="BAG_UNDERWEIGHT",t[t.BAG_NOT_SETTLED=328]="BAG_NOT_SETTLED",t[t.BAG_NOT_CONVEYABLE=329]="BAG_NOT_CONVEYABLE",t[t.BHS_OFFLINE=330]="BHS_OFFLINE",t[t.BHS_BUSY=331]="BHS_BUSY",t[t.FRONT_BAG_BLOCKING_REAR_RETURN=332]="FRONT_BAG_BLOCKING_REAR_RETURN",t[t.TECHNICAL_ERROR=333]="TECHNICAL_ERROR",t[t.BAG_UNEXPECTEDLY_REMOVED=334]="BAG_UNEXPECTEDLY_REMOVED",t))(qr||{});var Yr=(u=>(u[u.CUSS=1]="CUSS",u[u.NONCUSS=2]="NONCUSS",u[u.SELF_BOARDING_MODE=5]="SELF_BOARDING_MODE",u[u.LOCKED_MODE=6]="LOCKED_MODE",u[u.OPEN_MODE=7]="OPEN_MODE",u[u.DEBOARDING_MODE=8]="DEBOARDING_MODE",u[u.EMERGENCY_MODE=9]="EMERGENCY_MODE",u[u.MAINTENANCE_MODE=10]="MAINTENANCE_MODE",u))(Yr||{});var zr=(c=>(c[c.TAGGING_KIOSK=1]="TAGGING_KIOSK",c[c.CHECKIN_KIOSK=2]="CHECKIN_KIOSK",c[c.GATE=3]="GATE",c[c.ADMIN_PANEL=4]="ADMIN_PANEL",c[c.HUB=5]="HUB",c[c.CUSTOM_APP=6]="CUSTOM_APP",c[c.PLATFORM=7]="PLATFORM",c[c.PROXY=8]="PROXY",c[c.EXTERNAL_API=9]="EXTERNAL_API",c))(zr||{});var Dr=(a=>(a[a.SUCCESS=200]="SUCCESS",a[a.MODE_CHANGE=300]="MODE_CHANGE",a[a.FAILURE=400]="FAILURE",a[a.CRITICAL_FAILURE=500]="CRITICAL_FAILURE",a[a.INFRACTION=501]="INFRACTION",a[a.TIMEOUT=502]="TIMEOUT",a))(Dr||{});var Pr=(i=>(i.INFO="INFO",i.DELAYED="DELAYED",i.ERROR="ERROR",i.CRITICAL="CRITICAL",i))(Pr||{});function Xr(){return crypto.randomUUID()}var k=class{constructor(r,e){this.fn=r;this.delay=e}timeoutId=null;lastCall=0;call(...r){let e=Date.now();e-this.lastCall<this.delay||(this.timeoutId&&clearTimeout(this.timeoutId),this.lastCall=e,this.fn(...r))}async callAsync(...r){let e=Date.now();if(!(e-this.lastCall<this.delay))return this.timeoutId&&clearTimeout(this.timeoutId),this.lastCall=e,await this.fn(...r)}reset(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.lastCall=0}},rr=class{constructor(r=6e4,e=!0){this.ttl=r;e&&this.startAutoCleanup()}cache=new Map;cleanupInterval=null;set(r,e,n){let i=Date.now()+(n||this.ttl);this.cache.set(r,{value:e,expires:i})}get(r){let e=this.cache.get(r);if(e){if(Date.now()>e.expires){this.cache.delete(r);return}return e.value}}has(r){return this.get(r)!==void 0}delete(r){return this.cache.delete(r)}clear(){this.cache.clear()}startAutoCleanup(){this.cleanupInterval=setInterval(()=>{let r=Date.now();for(let[e,n]of this.cache.entries())r>n.expires&&this.cache.delete(e)},this.ttl)}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.clear()}};var x=class{coreInfo=null;configured=!1;headers=new Headers;config(r){this.validateCoreInfo(r),this.coreInfo=r,this.setupHeaders(),this.configured=!0}refreshInfo(r){this.config(r)}validateCoreInfo(r){if(!r.token)throw new Error("Token is required in CoreInfo");if(!r.serviceEndpoint)throw new Error("Service endpoint is required in CoreInfo")}setupHeaders(){this.coreInfo&&(this.headers=new Headers({"Elevated-Auth":btoa(this.coreInfo.token),"Content-Type":"application/json"}))}checkConfiguration(){if(!this.configured||!this.coreInfo)throw new Error("Service not configured. Call config() first with CoreInfo")}getHeadersObject(r){let e={};return r.forEach((n,i)=>{e[i]=n}),e}async makeRequest(r,e={}){this.checkConfiguration();let n=`${this.coreInfo.serviceEndpoint}${r}`,i=this.coreInfo.timeout||3e4,s=new AbortController,a=setTimeout(()=>s.abort(),i);try{let f=await fetch(n,{...e,headers:{...this.getHeadersObject(this.headers),...this.getHeadersObject(new Headers(e.headers||{}))},signal:s.signal});if(clearTimeout(a),!f.ok)throw new Error(`HTTP error! status: ${f.status}`);return{success:!0,data:await f.json()}}catch(f){return clearTimeout(a),f instanceof Error?f.name==="AbortError"?{success:!1,error:"Request timeout",message:`Request timed out after ${i}ms`}:{success:!1,error:f.message}:{success:!1,error:"Unknown error occurred"}}}post(r,e){return this.makeRequest(r,{method:"POST",body:JSON.stringify(e)})}patch(r,e){return this.makeRequest(r,{method:"PATCH",body:JSON.stringify(e)})}get(r,e){return this.makeRequest(r,{method:"GET",headers:e})}put(r,e){return this.makeRequest(r,{method:"PUT",body:JSON.stringify(e)})}delete(r){return this.makeRequest(r,{method:"DELETE"})}};var V=class extends x{defaults={};debouncedEvents=new Map;setDefaults(r){this.defaults={...r},r.debounceEvent&&r.debounceEvent.forEach(({eventCode:e,debounce:n})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:n,once:!1})}),r.debounceOnce&&r.debounceOnce.forEach(({eventCode:e,debounce:n})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:n,once:!0})})}shouldDebounce(r){let e=this.debouncedEvents.get(r);if(!e)return!1;let n=Date.now();return n-e.lastSent<e.debounceTime?!0:(e.lastSent=n,e.once&&this.debouncedEvents.delete(r),!1)}async send(r,e=null){this.checkConfiguration();let n={eventType:this.defaults.eventType,eventMode:this.defaults.eventMode,ownerID:this.defaults.ownerID,created:new Date,...r,eventData:r.eventData||{}};if(!n.metaData){let i={};n.eventCode&&(i.eventCode=n.eventCode),n.eventData&&n.eventData.airline&&(i.airline=n.eventData.airline),n.eventData&&n.eventData.countryCode&&(i.countryCode=n.eventData.countryCode),n.ownerID&&(i.ownerID=n.ownerID),e&&(i.tags=e.tags||[],i.location=e.location||void 0,i.testDevice=!!e.metadata?.testDevice),n.metaData=i}if(n.eventCode&&this.shouldDebounce(n.eventCode))return{success:!0,message:"Event debounced"};try{return await this.post("/events",n)}catch(i){return console.error("Failed to send event:",i),{success:!1,error:"Failed to send event"}}}success(r){return this.send({...r,statusCode:200})}failure(r){return this.send({...r,statusCode:400})}error(r){return this.send({...r,statusCode:400})}critical(r){return this.send({...r,statusCode:500})}infraction(r){return this.send({...r,statusCode:501})}timeout(r){return this.send({...r,statusCode:502})}modeChange(r){return this.send({...r,statusCode:300})}addDebounce(r){r.forEach(({eventCode:e,debounce:n})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:n,once:!1})})}addDebounceOnce(r){r.forEach(({eventCode:e,debounce:n})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:n,once:!0})})}clearDebounce(){this.debouncedEvents.clear()}reset(){this.clearDebounce(),this.defaults={}}},er=new V;var W=class extends x{defaults={};debouncer;lastLogHash=new Map;setDefaults(r){this.defaults={...r},r.debounce&&(this.debouncer=new k(async e=>await this.sendLog(e),r.debounce))}createLogHash(r){return`${r.level}-${r.message}-${r.applicationName}-${r.statusCode}`}shouldDebounce(r){if(!this.defaults.debounce)return!1;let e=this.createLogHash(r),n=Date.now(),i=this.lastLogHash.get(e)||0;return n-i<this.defaults.debounce?!0:(this.lastLogHash.set(e,n),!1)}async message(r){this.checkConfiguration();let e={deviceId:this.defaults.deviceId||"",applicationName:this.defaults.applicationName,statusCode:this.defaults.statusCode,level:"INFO",...r,message:r.message||""};if(!e.deviceId)throw new Error("deviceId is required for logging");if(!e.message)throw new Error("message is required for logging");return this.shouldDebounce(e)?{success:!0,message:"Log debounced"}:await this.sendLog(e)}async sendLog(r){try{return await this.post("/logs",r)}catch(e){return console.error("Failed to send log:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}information(r){return this.message({...r,level:"INFO"})}delayed(r){return this.message({...r,level:"DELAYED"})}error(r){return this.message({...r,level:"ERROR"})}critical(r){return this.message({...r,level:"CRITICAL"})}async batch(r){this.checkConfiguration();try{let n=(await Promise.all(r.map(i=>this.message(i)))).filter(i=>!i.success);return n.length===0?{success:!0,message:`Successfully sent ${r.length} logs`}:{success:!1,error:`Failed to send ${n.length} of ${r.length} logs`,data:{failures:n}}}catch(e){return console.error("Failed to send batch logs:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}clearDebounce(){this.lastLogHash.clear(),this.debouncer&&this.debouncer.reset()}reset(){this.clearDebounce(),this.defaults={},this.debouncer=void 0}getStats(){return{debounceActive:!!this.debouncer,cacheSize:this.lastLogHash.size,defaults:this.defaults}}},tr=new W;var Er=function(o,r){return Er=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,n){e.__proto__=n}||function(e,n){for(var i in n)Object.prototype.hasOwnProperty.call(n,i)&&(e[i]=n[i])},Er(o,r)};function S(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");Er(o,r);function e(){this.constructor=o}o.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function Zr(o,r,e,n){function i(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function f(m){try{c(n.next(m))}catch(g){a(g)}}function u(m){try{c(n.throw(m))}catch(g){a(g)}}function c(m){m.done?s(m.value):i(m.value).then(f,u)}c((n=n.apply(o,r||[])).next())})}function or(o,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=f(0),a.throw=f(1),a.return=f(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function f(c){return function(m){return u([c,m])}}function u(c){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(e=0)),e;)try{if(n=1,i&&(s=c[0]&2?i.return:c[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,c[1])).done)return s;switch(i=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,i=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){e.label=c[1];break}if(c[0]===6&&e.label<s[1]){e.label=s[1],s=c;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(c);break}s[2]&&e.ops.pop(),e.trys.pop();continue}c=r.call(o,e)}catch(m){c=[6,m],i=0}finally{n=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function R(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],n=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&n>=o.length&&(o=void 0),{value:o&&o[n++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var n=e.call(o),i,s=[],a;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(f){a={error:f}}finally{try{i&&!i.done&&(e=n.return)&&e.call(n)}finally{if(a)throw a.error}}return s}function v(o,r,e){if(e||arguments.length===2)for(var n=0,i=r.length,s;n<i;n++)(s||!(n in r))&&(s||(s=Array.prototype.slice.call(r,0,n)),s[n]=r[n]);return o.concat(s||Array.prototype.slice.call(r))}function P(o){return this instanceof P?(this.v=o,this):new P(o)}function Jr(o,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var n=e.apply(o,r||[]),i,s=[];return i=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),f("next"),f("throw"),f("return",a),i[Symbol.asyncIterator]=function(){return this},i;function a(p){return function(_){return Promise.resolve(_).then(p,g)}}function f(p,_){n[p]&&(i[p]=function(h){return new Promise(function(L,j){s.push([p,h,L,j])>1||u(p,h)})},_&&(i[p]=_(i[p])))}function u(p,_){try{c(n[p](_))}catch(h){y(s[0][3],h)}}function c(p){p.value instanceof P?Promise.resolve(p.value.v).then(m,g):y(s[0][2],p)}function m(p){u("next",p)}function g(p){u("throw",p)}function y(p,_){p(_),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Qr(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],e;return r?r.call(o):(o=typeof R=="function"?R(o):o[Symbol.iterator](),e={},n("next"),n("throw"),n("return"),e[Symbol.asyncIterator]=function(){return this},e);function n(s){e[s]=o[s]&&function(a){return new Promise(function(f,u){a=o[s](a),i(f,u,a.done,a.value)})}}function i(s,a,f,u){Promise.resolve(u).then(function(c){s({value:c,done:f})},a)}}function l(o){return typeof o=="function"}function F(o){var r=function(n){Error.call(n),n.stack=new Error().stack},e=o(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var nr=F(function(o){return function(e){o(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(n,i){return i+1+") "+n.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function $(o,r){if(o){var e=o.indexOf(r);0<=e&&o.splice(e,1)}}var G=function(){function o(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return o.prototype.unsubscribe=function(){var r,e,n,i,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var f=R(a),u=f.next();!u.done;u=f.next()){var c=u.value;c.remove(this)}}catch(h){r={error:h}}finally{try{u&&!u.done&&(e=f.return)&&e.call(f)}finally{if(r)throw r.error}}else a.remove(this);var m=this.initialTeardown;if(l(m))try{m()}catch(h){s=h instanceof nr?h.errors:[h]}var g=this._finalizers;if(g){this._finalizers=null;try{for(var y=R(g),p=y.next();!p.done;p=y.next()){var _=p.value;try{Cr(_)}catch(h){s=s??[],h instanceof nr?s=v(v([],N(s)),N(h.errors)):s.push(h)}}}catch(h){n={error:h}}finally{try{p&&!p.done&&(i=y.return)&&i.call(y)}finally{if(n)throw n.error}}}if(s)throw new nr(s)}},o.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)Cr(r);else{if(r instanceof o){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},o.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},o.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},o.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&$(e,r)},o.prototype.remove=function(r){var e=this._finalizers;e&&$(e,r),r instanceof o&&r._removeParent(this)},o.EMPTY=function(){var r=new o;return r.closed=!0,r}(),o}();var Lr=G.EMPTY;function ir(o){return o instanceof G||o&&"closed"in o&&l(o.remove)&&l(o.add)&&l(o.unsubscribe)}function Cr(o){l(o)?o():o.unsubscribe()}var O={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var U={setTimeout:function(o,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];var i=U.delegate;return i?.setTimeout?i.setTimeout.apply(i,v([o,r],N(e))):setTimeout.apply(void 0,v([o,r],N(e)))},clearTimeout:function(o){var r=U.delegate;return(r?.clearTimeout||clearTimeout)(o)},delegate:void 0};function sr(o){U.setTimeout(function(){var r=O.onUnhandledError;if(r)r(o);else throw o})}function kr(){}var re=function(){return Fr("C",void 0,void 0)}();function ee(o){return Fr("E",void 0,o)}function te(o){return Fr("N",o,void 0)}function Fr(o,r,e){return{kind:o,value:r,error:e}}var E=null;function M(o){if(O.useDeprecatedSynchronousErrorHandling){var r=!E;if(r&&(E={errorThrown:!1,error:null}),o(),r){var e=E,n=e.errorThrown,i=e.error;if(E=null,n)throw i}}else o()}function oe(o){O.useDeprecatedSynchronousErrorHandling&&E&&(E.errorThrown=!0,E.error=o)}var K=function(o){S(r,o);function r(e){var n=o.call(this)||this;return n.isStopped=!1,e?(n.destination=e,ir(e)&&e.add(n)):n.destination=De,n}return r.create=function(e,n,i){return new w(e,n,i)},r.prototype.next=function(e){this.isStopped?Ur(te(e),this):this._next(e)},r.prototype.error=function(e){this.isStopped?Ur(ee(e),this):(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped?Ur(re,this):(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(G);var we=Function.prototype.bind;function Gr(o,r){return we.call(o,r)}var Ne=function(){function o(r){this.partialObserver=r}return o.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(n){ar(n)}},o.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(n){ar(n)}else ar(r)},o.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){ar(e)}},o}(),w=function(o){S(r,o);function r(e,n,i){var s=o.call(this)||this,a;if(l(e)||!e)a={next:e??void 0,error:n??void 0,complete:i??void 0};else{var f;s&&O.useDeprecatedNextContext?(f=Object.create(e),f.unsubscribe=function(){return s.unsubscribe()},a={next:e.next&&Gr(e.next,f),error:e.error&&Gr(e.error,f),complete:e.complete&&Gr(e.complete,f)}):a=e}return s.destination=new Ne(a),s}return r}(K);function ar(o){O.useDeprecatedSynchronousErrorHandling?oe(o):sr(o)}function ve(o){throw o}function Ur(o,r){var e=O.onStoppedNotification;e&&U.setTimeout(function(){return e(o,r)})}var De={closed:!0,next:kr,error:ve,complete:kr};var B=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function cr(o){return o}function ne(o){return o.length===0?cr:o.length===1?o[0]:function(e){return o.reduce(function(n,i){return i(n)},e)}}var b=function(){function o(r){r&&(this._subscribe=r)}return o.prototype.lift=function(r){var e=new o;return e.source=this,e.operator=r,e},o.prototype.subscribe=function(r,e,n){var i=this,s=Ee(r)?r:new w(r,e,n);return M(function(){var a=i,f=a.operator,u=a.source;s.add(f?f.call(s,u):u?i._subscribe(s):i._trySubscribe(s))}),s},o.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},o.prototype.forEach=function(r,e){var n=this;return e=ie(e),new e(function(i,s){var a=new w({next:function(f){try{r(f)}catch(u){s(u),a.unsubscribe()}},error:s,complete:i});n.subscribe(a)})},o.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},o.prototype[B]=function(){return this},o.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return ne(r)(this)},o.prototype.toPromise=function(r){var e=this;return r=ie(r),new r(function(n,i){var s;e.subscribe(function(a){return s=a},function(a){return i(a)},function(){return n(s)})})},o.create=function(r){return new o(r)},o}();function ie(o){var r;return(r=o??O.Promise)!==null&&r!==void 0?r:Promise}function Pe(o){return o&&l(o.next)&&l(o.error)&&l(o.complete)}function Ee(o){return o&&o instanceof K||Pe(o)&&ir(o)}function Le(o){return l(o?.lift)}function I(o){return function(r){if(Le(r))return r.lift(function(e){try{return o(e,this)}catch(n){this.error(n)}});throw new TypeError("Unable to lift unknown Observable type")}}function D(o,r,e,n,i){return new ke(o,r,e,n,i)}var ke=function(o){S(r,o);function r(e,n,i,s,a,f){var u=o.call(this,e)||this;return u.onFinalize=a,u.shouldUnsubscribe=f,u._next=n?function(c){try{n(c)}catch(m){e.error(m)}}:o.prototype._next,u._error=s?function(c){try{s(c)}catch(m){e.error(m)}finally{this.unsubscribe()}}:o.prototype._error,u._complete=i?function(){try{i()}catch(c){e.error(c)}finally{this.unsubscribe()}}:o.prototype._complete,u}return r.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var n=this.closed;o.prototype.unsubscribe.call(this),!n&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},r}(K);var se=F(function(o){return function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var d=function(o){S(r,o);function r(){var e=o.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var n=new ae(this,this);return n.operator=e,n},r.prototype._throwIfClosed=function(){if(this.closed)throw new se},r.prototype.next=function(e){var n=this;M(function(){var i,s;if(n._throwIfClosed(),!n.isStopped){n.currentObservers||(n.currentObservers=Array.from(n.observers));try{for(var a=R(n.currentObservers),f=a.next();!f.done;f=a.next()){var u=f.value;u.next(e)}}catch(c){i={error:c}}finally{try{f&&!f.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}}})},r.prototype.error=function(e){var n=this;M(function(){if(n._throwIfClosed(),!n.isStopped){n.hasError=n.isStopped=!0,n.thrownError=e;for(var i=n.observers;i.length;)i.shift().error(e)}})},r.prototype.complete=function(){var e=this;M(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var n=e.observers;n.length;)n.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),o.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var n=this,i=this,s=i.hasError,a=i.isStopped,f=i.observers;return s||a?Lr:(this.currentObservers=null,f.push(e),new G(function(){n.currentObservers=null,$(f,e)}))},r.prototype._checkFinalizedStatuses=function(e){var n=this,i=n.hasError,s=n.thrownError,a=n.isStopped;i?e.error(s):a&&e.complete()},r.prototype.asObservable=function(){var e=new b;return e.source=this,e},r.create=function(e,n){return new ae(e,n)},r}(b);var ae=function(o){S(r,o);function r(e,n){var i=o.call(this)||this;return i.destination=e,i.source=n,i}return r.prototype.next=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.next)===null||i===void 0||i.call(n,e)},r.prototype.error=function(e){var n,i;(i=(n=this.destination)===null||n===void 0?void 0:n.error)===null||i===void 0||i.call(n,e)},r.prototype.complete=function(){var e,n;(n=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||n===void 0||n.call(e)},r.prototype._subscribe=function(e){var n,i;return(i=(n=this.source)===null||n===void 0?void 0:n.subscribe(e))!==null&&i!==void 0?i:Lr},r}(d);var ur=function(o){S(r,o);function r(e){var n=o.call(this)||this;return n._value=e,n}return Object.defineProperty(r.prototype,"value",{get:function(){return this.getValue()},enumerable:!1,configurable:!0}),r.prototype._subscribe=function(e){var n=o.prototype._subscribe.call(this,e);return!n.closed&&e.next(this._value),n},r.prototype.getValue=function(){var e=this,n=e.hasError,i=e.thrownError,s=e._value;if(n)throw i;return this._throwIfClosed(),s},r.prototype.next=function(e){o.prototype.next.call(this,this._value=e)},r}(d);var Mr=new b(function(o){return o.complete()});function ce(o){return o&&l(o.schedule)}function Fe(o){return o[o.length-1]}function ue(o){return ce(Fe(o))?o.pop():void 0}var fr=function(o){return o&&typeof o.length=="number"&&typeof o!="function"};function lr(o){return l(o?.then)}function pr(o){return l(o[B])}function mr(o){return Symbol.asyncIterator&&l(o?.[Symbol.asyncIterator])}function hr(o){return new TypeError("You provided "+(o!==null&&typeof o=="object"?"an invalid object":"'"+o+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function Ge(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var br=Ge();function dr(o){return l(o?.[br])}function gr(o){return Jr(this,arguments,function(){var e,n,i,s;return or(this,function(a){switch(a.label){case 0:e=o.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,P(e.read())];case 3:return n=a.sent(),i=n.value,s=n.done,s?[4,P(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,P(i)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function xr(o){return l(o?.getReader)}function A(o){if(o instanceof b)return o;if(o!=null){if(pr(o))return Ue(o);if(fr(o))return Me(o);if(lr(o))return Be(o);if(mr(o))return fe(o);if(dr(o))return je(o);if(xr(o))return He(o)}throw hr(o)}function Ue(o){return new b(function(r){var e=o[B]();if(l(e.subscribe))return e.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function Me(o){return new b(function(r){for(var e=0;e<o.length&&!r.closed;e++)r.next(o[e]);r.complete()})}function Be(o){return new b(function(r){o.then(function(e){r.closed||(r.next(e),r.complete())},function(e){return r.error(e)}).then(null,sr)})}function je(o){return new b(function(r){var e,n;try{for(var i=R(o),s=i.next();!s.done;s=i.next()){var a=s.value;if(r.next(a),r.closed)return}}catch(f){e={error:f}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}r.complete()})}function fe(o){return new b(function(r){Ve(o,r).catch(function(e){return r.error(e)})})}function He(o){return fe(gr(o))}function Ve(o,r){var e,n,i,s;return Zr(this,void 0,void 0,function(){var a,f;return or(this,function(u){switch(u.label){case 0:u.trys.push([0,5,6,11]),e=Qr(o),u.label=1;case 1:return[4,e.next()];case 2:if(n=u.sent(),!!n.done)return[3,4];if(a=n.value,r.next(a),r.closed)return[2];u.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return f=u.sent(),i={error:f},[3,11];case 6:return u.trys.push([6,,9,10]),n&&!n.done&&(s=e.return)?[4,s.call(e)]:[3,8];case 7:u.sent(),u.label=8;case 8:return[3,10];case 9:if(i)throw i.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function T(o,r,e,n,i){n===void 0&&(n=0),i===void 0&&(i=!1);var s=r.schedule(function(){e(),i?o.add(this.schedule(null,n)):this.unsubscribe()},n);if(o.add(s),!i)return s}function _r(o,r){return r===void 0&&(r=0),I(function(e,n){e.subscribe(D(n,function(i){return T(n,o,function(){return n.next(i)},r)},function(){return T(n,o,function(){return n.complete()},r)},function(i){return T(n,o,function(){return n.error(i)},r)}))})}function yr(o,r){return r===void 0&&(r=0),I(function(e,n){n.add(o.schedule(function(){return e.subscribe(n)},r))})}function le(o,r){return A(o).pipe(yr(r),_r(r))}function pe(o,r){return A(o).pipe(yr(r),_r(r))}function me(o,r){return new b(function(e){var n=0;return r.schedule(function(){n===o.length?e.complete():(e.next(o[n++]),e.closed||this.schedule())})})}function he(o,r){return new b(function(e){var n;return T(e,r,function(){n=o[br](),T(e,r,function(){var i,s,a;try{i=n.next(),s=i.value,a=i.done}catch(f){e.error(f);return}a?e.complete():e.next(s)},0,!0)}),function(){return l(n?.return)&&n.return()}})}function Ir(o,r){if(!o)throw new Error("Iterable cannot be null");return new b(function(e){T(e,r,function(){var n=o[Symbol.asyncIterator]();T(e,r,function(){n.next().then(function(i){i.done?e.complete():e.next(i.value)})},0,!0)})})}function be(o,r){return Ir(gr(o),r)}function de(o,r){if(o!=null){if(pr(o))return le(o,r);if(fr(o))return me(o,r);if(lr(o))return pe(o,r);if(mr(o))return Ir(o,r);if(dr(o))return he(o,r);if(xr(o))return be(o,r)}throw hr(o)}function q(o,r){return r?de(o,r):A(o)}function Br(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var e=ue(o);return q(o,e)}var ge=F(function(o){return function(){o(this),this.name="EmptyError",this.message="no elements in sequence"}});function jr(o,r){var e=typeof r=="object";return new Promise(function(n,i){var s=new w({next:function(a){n(a),s.unsubscribe()},error:i,complete:function(){e?n(r.defaultValue):i(new ge)}});o.subscribe(s)})}function Hr(o,r){return I(function(e,n){var i=0;e.subscribe(D(n,function(s){n.next(o.call(r,s,i++))}))})}function Or(o){return I(function(r,e){var n=null,i=!1,s;n=r.subscribe(D(e,void 0,void 0,function(a){s=A(o(a,Or(o)(r))),n?(n.unsubscribe(),n=null,s.subscribe(e)):i=!0})),i&&(n.unsubscribe(),n=null,s.subscribe(e))})}function Wr(o){o===void 0&&(o={});var r=o.connector,e=r===void 0?function(){return new d}:r,n=o.resetOnError,i=n===void 0?!0:n,s=o.resetOnComplete,a=s===void 0?!0:s,f=o.resetOnRefCountZero,u=f===void 0?!0:f;return function(c){var m,g,y,p=0,_=!1,h=!1,L=function(){g?.unsubscribe(),g=void 0},j=function(){L(),m=y=void 0,_=h=!1},_e=function(){var H=m;j(),H?.unsubscribe()};return I(function(H,Kr){p++,!h&&!_&&L();var Q=y=y??e();Kr.add(function(){p--,p===0&&!h&&!_&&(g=Vr(_e,u))}),Q.subscribe(Kr),!m&&p>0&&(m=new w({next:function(C){return Q.next(C)},error:function(C){h=!0,L(),g=Vr(j,i,C),Q.error(C)},complete:function(){_=!0,L(),g=Vr(j,a),Q.complete()}}),A(H).subscribe(m))})(c)}}function Vr(o,r){for(var e=[],n=2;n<arguments.length;n++)e[n-2]=arguments[n];if(r===!0){o();return}if(r!==!1){var i=new w({next:function(){i.unsubscribe(),o()}});return A(r.apply(void 0,v([],N(e)))).subscribe(i)}}function Ar(o,r,e){var n=l(o)||r||e?{next:o,error:r,complete:e}:o;return n?I(function(i,s){var a;(a=n.subscribe)===null||a===void 0||a.call(n);var f=!0;i.subscribe(D(s,function(u){var c;(c=n.next)===null||c===void 0||c.call(n,u),s.next(u)},function(){var u;f=!1,(u=n.complete)===null||u===void 0||u.call(n),s.complete()},function(u){var c;f=!1,(c=n.error)===null||c===void 0||c.call(n,u),s.error(u)},function(){var u,c;f&&((u=n.unsubscribe)===null||u===void 0||u.call(n)),(c=n.finalize)===null||c===void 0||c.call(n)}))}):cr}var xe=Ae("socket.io-client"),Y=class extends x{socket=null;socket$=new ur(null);isConnected=new ur(!1);onConnected=new d;onDisconnect=new d;onConfigurationRequired=new d;onCommand=new d;onFlightInfo=new d;onRefresh=new d;onPrint=new d;onRestart=new d;onEvent=new d;onToast=new d;onlineKiosks=new d;reconnectTimer=null;reconnectAttempts=0;maxReconnectAttempts=10;reconnectDelay=1e3;iotInfo={appName:"ElevationDenoService"};config(r,e){super.config(r),e&&(this.iotInfo=e),this.connect()}refreshInfo(r){this.config(r)}connect(){if(!this.coreInfo||!this.coreInfo.iotEndpoint){console.error("IOT endpoint not configured");return}try{this.disconnect(!1);let r=this.coreInfo.iotEvents?"/events":"/device",n=`${this.coreInfo.iotEndpoint.replace(/\/$/,"")}${r}`;console.log(`Connecting to Socket.io server at ${n}`),this.socket=(0,xe.io)(n,{query:{token:this.coreInfo.token,key:this.coreInfo.fingerPrint,app:this.iotInfo.appName,version:this.iotInfo.appVersion||"1.0.0",secondary:this.coreInfo.secondary||!1}}),this.socket$.next(this.socket),this.setupSocketHandlers()}catch(r){console.error("Failed to create Socket.io connection:",r),this.scheduleReconnect()}}setupSocketHandlers(){this.socket&&(this.socket.on("connect",()=>{console.log("IOT Socket.io connected:",this.socket?.id),this.isConnected.next(!0),this.onConnected.next(),this.reconnectAttempts=0}),this.socket.on("disconnect",r=>{console.log("IOT Socket.io disconnected:",r),this.isConnected.next(!1),this.onDisconnect.next(),r==="io server disconnect"&&this.socket?.connect()}),this.socket.on("connect_error",r=>{console.error("IOT Socket.io connection error:",r.message),(r.message?.includes("5000")||r.message?.includes("5001")||r.message?.includes("Configuration")||r.message?.includes("Unauthorized"))&&(console.error("Configuration error received"),this.onConfigurationRequired.next(),this.disconnect(!0))}),this.socket.on("command",r=>{this.onCommand.next(r)}),this.socket.on("flightinfo",r=>{this.onFlightInfo.next(r)}),this.socket.on("event",r=>{this.onEvent.next(r)}),this.socket.on("toast",r=>{this.onToast.next(r)}),this.socket.on("refresh",()=>{this.onRefresh.next()}),this.socket.on("onlineKiosks",r=>{this.onlineKiosks.next(r)}),this.socket.on("print",r=>{this.onPrint.next(r)}),this.socket.on("restart",()=>{this.onRestart.next()}),this.socket.on("error",r=>{if(console.error("IOT Socket.io error:",r),typeof r=="object"&&r!==null){let e=r.message||r.reason||"";(e.includes("Configuration")||e.includes("5000")||e.includes("5001"))&&(this.onConfigurationRequired.next(),this.disconnect(!0))}}),this.socket.on("ping",()=>{this.socket?.emit("pong")}))}scheduleReconnect(){if(this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}let r=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts),3e4);this.reconnectAttempts++,console.log(`Scheduling reconnection attempt ${this.reconnectAttempts} in ${r}ms`),this.reconnectTimer=setTimeout(()=>{this.connect()},r)}send(r){this.socket&&this.socket.connected?r.type?this.socket.emit(r.type,r.data||r):this.socket.emit("message",r):console.warn("Cannot send data: Socket.io not connected")}sendMessage(r,e){this.socket&&this.socket.connected?this.socket.emit(r,e):console.warn(`Cannot send ${r}: Socket.io not connected`)}disconnect(r=!1){this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.socket&&(this.socket.removeAllListeners(),this.socket.disconnect(),this.socket=null),this.isConnected.next(!1)}reconnect(){this.reconnectAttempts=0,this.connect()}getConnectionStatus(){return this.isConnected&&this.socket?.connected===!0}getSocketId(){return this.socket?.id}destroy(){this.disconnect(!1),this.onConnected.complete(),this.onDisconnect.complete(),this.onConfigurationRequired.complete(),this.onCommand.complete(),this.onFlightInfo.complete(),this.onRefresh.complete(),this.onPrint.complete(),this.onRestart.complete(),this.onEvent.complete(),this.onToast.complete(),this.onlineKiosks.complete()}},Sr=new Y;var z=class extends x{started=!1;config(r){if(super.config(r),!r.fingerPrint)throw new Error("fingerPrint is required in CoreInfo for Enrollment service")}async start(){this.checkConfiguration();let r=await this.get("/devices/key");if(r.success&&r.data){let e=r.data[0];if(e.metadata?.configured)throw new Error("Device is already enrolled");return this.started=!0,e}throw new Error(r.error||"Failed to start enrollment")}async getLocations(){this.checkConfiguration();let r=await this.get("/locations");if(r.success&&r.data)return r.data;throw new Error(r.error||"Failed to get locations")}async getSpecification(){this.checkConfiguration();let r=await this.get("/speficiations");if(r.success&&r.data)return r.data;throw new Error(r.error||"Failed to get specifications")}async enrollDevice(r){if(this.checkConfiguration(),!this.started)throw new Error("start subscription first");if(!r.label)throw new Error("Device label is required");if(!r.device?._id)throw new Error("Missing Device information");if(!r.location?._id)throw new Error("Location is required");if(!r.terminal?._id)throw new Error("Terminal is required");if(!r.specification?.id)throw new Error("Specification is required");if(!await this.isLabelAvailable(r.label))throw new Error(`Device label '${r.label}' is already in use`);return r.device.label=r.label,r.device.location=r.location._id,r.device.terminal=r.terminal._id,r.specification&&(r.device.hardware={model:r.specification.model}),r.metadata&&(r.device.metadata=r.metadata),r.location?.configurations&&(r.device.configurations={...r.location.configurations,...r.device.configurations}),await this.patch(`/devices/${r.device._id}`,r.device)}async isLabelAvailable(r){if(this.checkConfiguration(),!r)return!1;let e=await this.get(`/devices/label/${r}`,{});return e.success&&e.data?e.data.length===0:!1}},Tr=new z;var X=class extends x{configInfo=null;config(r,e){super.config(r),e&&this.setConfigInfo(e)}setConfigInfo(r){if(!r.deviceId||!r.locationId)throw new Error("Both deviceId and locationId are required in ElevatedConfigurationsInfo");this.configInfo=r}checkConfigInfo(){if(!this.configInfo)throw new Error("ElevatedConfigurationsInfo not set. Call setConfigInfo() first")}getConfig(r){return this.checkConfiguration(),this.checkConfigInfo(),this.get(`/configurations/${r}/${this.configInfo?.locationId}/${this.configInfo?.deviceId}`,{"Cache-Control":"no-cache"}).then(e=>e.data||null).catch(e=>(console.error("Error fetching configuration:",e),null))}getConfigs(r){return Promise.all(r.map(e=>this.getConfig(e)))}},Rr=new X;var Z=class extends x{stringsObservable=null;cmsCache=new Map;allStrings=null;reqHeaderNoCache={"Cache-Control":"no-cache"};async getKey(r,e,n=!1,i=!0){if(this.checkConfiguration(),i&&this.allStrings?.length){let s=this.cmsCache.get(`${r}-${e}`),a=this.cmsCache.get(`${r}-en-US`),f=s!==void 0?s:a!==void 0?a:null;return n&&f?JSON.parse(f):f}if(!i||!this.allStrings?.length){try{await jr(this.loadAllStrings(n))}catch(u){console.error("Failed to load strings for key lookup:",u)}let s=this.cmsCache.get(`${r}-${e}`),a=this.cmsCache.get(`${r}-en-US`),f=s!==void 0?s:a!==void 0?a:null;return n&&f?JSON.parse(f):f}return null}getString(r,e,n=!0){return this.getKey(r,e,!1,n)}getConfig(r,e,n=!0){return this.getKey(r,e,!0,n)}loadAllStrings(r=!1){return this.checkConfiguration(),!r&&this.stringsObservable?this.stringsObservable:!r&&this.allStrings&&this.allStrings.length>0?Br(this.allStrings):(this.stringsObservable=q(this.get("/strings",r?this.reqHeaderNoCache:void 0)).pipe(Hr(e=>{if(!e.success||!e.data)throw new Error("Failed to load CMS strings");return e.data}),Ar(e=>{this.allStrings=e,this.updateCacheFromStrings(this.allStrings)}),Or(e=>(console.error("Failed to load CMS strings:",e),this.stringsObservable=null,Mr)),Wr(),Ar({complete:()=>{setTimeout(()=>{this.stringsObservable=null},0)}})),this.stringsObservable)}getAllStrings(){return this.allStrings}clearCache(){this.cmsCache.clear()}getCacheStats(){return{size:this.cmsCache.size,keys:Array.from(this.cmsCache.keys())}}updateCacheFromStrings(r){for(let e of r)for(let[n,i]of Object.entries(e.languages)){let s=i.versions.find(a=>a.published)||i.versions[0];if(s){let a=`${e.element}-${n}`;this.cmsCache.set(a,s.string)}}}destroy(){this.clearCache(),this.allStrings=null}},wr=new Z;var J=class extends x{touchPointId=null;getDeviceByFingerPrint(){if(this.checkConfiguration(),!this.coreInfo?.fingerPrint)throw new Error("Device fingerprint is required for TouchPoint service");return this.get(`/devices/key/${this.coreInfo.fingerPrint}`).then(r=>{if(r.data?.length){let e=r.data[0];return e&&(this.touchPointId=e._id),e}return null}).catch(r=>(console.error(r),null))}getInfo(){return this.getDeviceByFingerPrint()}async inService(r,e){if(this.checkConfiguration(),!this.coreInfo?.fingerPrint)throw new Error("Device fingerprint is required for TouchPoint service");try{if(this.touchPointId||await this.getDeviceByFingerPrint(),!this.touchPointId)return;await this.post("/devices/service",{id:this.touchPointId,state:r,reason:e})}catch(n){console.error(`Unable to transition to state: ${r} ${n}`)}}},Nr=new J;var $r=class{events=er;logs=tr;iot=Sr;enrollment=Tr;config=Rr;cms=wr;touchPoint=Nr;initialize(r){this.events.config(r),this.logs.config(r),this.enrollment.config(r),this.cms.config(r),this.touchPoint.config(r),r.iotEndpoint&&r.fingerPrint&&this.iot.config(r)}};return Re(We);})();
//# sourceMappingURL=elevation-core.min.js.map
