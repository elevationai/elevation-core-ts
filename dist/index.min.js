var he=(t=>(t[t.PNR_RETRIEVAL=1]="PNR_RETRIEVAL",t[t.BAGTAG_PRINT=2]="BAGTAG_PRINT",t[t.PAPER_LOW=3]="PAPER_LOW",t[t.PAPER_OUT=4]="PAPER_OUT",t[t.UPPER_DOOR_OPEN=5]="UPPER_DOOR_OPEN",t[t.UPPER_DOOR_CLOSED=6]="UPPER_DOOR_CLOSED",t[t.LOWER_DOOR_OPEN=7]="LOWER_DOOR_OPEN",t[t.LOWER_DOOR_CLOSED=8]="LOWER_DOOR_CLOSED",t[t.PASS_SCANNED=9]="PASS_SCANNED",t[t.ONLINE=10]="ONLINE",t[t.OFFLINE=11]="OFFLINE",t[t.IN_SERVICE=12]="IN_SERVICE",t[t.OUT_OF_SERVICE=13]="OUT_OF_SERVICE",t[t.PAPER_JAM=14]="PAPER_JAM",t[t.TOO_LATE_FOR_FLIGHT=15]="TOO_LATE_FOR_FLIGHT",t[t.TOO_EARLY_FOR_FLIGHT=16]="TOO_EARLY_FOR_FLIGHT",t[t.INCORRECT_LOCATION=17]="INCORRECT_LOCATION",t[t.RESERVATION_NOT_FOUND=18]="RESERVATION_NOT_FOUND",t[t.BOARDING_PASS_INVALID=19]="BOARDING_PASS_INVALID",t[t.NOT_CHECKED_IN=120]="NOT_CHECKED_IN",t[t.INELIGIBLE=121]="INELIGIBLE",t[t.INTERNATIONAL=122]="INTERNATIONAL",t[t.PREVIOUSLY_PRINTED=123]="PREVIOUSLY_PRINTED",t[t.NO_BAGS=64]="NO_BAGS",t[t.WRONG_AIRLINE=65]="WRONG_AIRLINE",t[t.PRINTER_FAILURE=66]="PRINTER_FAILURE",t[t.UNAUTHORIZED_CROSSING_ENTRANCE=20]="UNAUTHORIZED_CROSSING_ENTRANCE",t[t.UNAUTHORIZED_CROSSING_EXIT=21]="UNAUTHORIZED_CROSSING_EXIT",t[t.FRAUD_CRAWLING=22]="FRAUD_CRAWLING",t[t.FRAUD_JUMP=23]="FRAUD_JUMP",t[t.UNAUTHORIZED_STANDING_AT_ENTRANCE=24]="UNAUTHORIZED_STANDING_AT_ENTRANCE",t[t.UNAUTHORIZED_STANDING_AT_EXIT=25]="UNAUTHORIZED_STANDING_AT_EXIT",t[t.STOP_IN_GATE=26]="STOP_IN_GATE",t[t.ONE_BOARD_ONE_LEFT_ENTRANCE=27]="ONE_BOARD_ONE_LEFT_ENTRANCE",t[t.TWO_BOARDED=28]="TWO_BOARDED",t[t.ONE_BOARDED_ONE_CROSSED=29]="ONE_BOARDED_ONE_CROSSED",t[t.ONE_CROSSED_LEFT_ENTRANCE=30]="ONE_CROSSED_LEFT_ENTRANCE",t[t.ONE_BOARDED_THEN_LEFT_VIA_ENTRANCE=31]="ONE_BOARDED_THEN_LEFT_VIA_ENTRANCE",t[t.BOARDED_WITHOUT_AUTHORIZATION=32]="BOARDED_WITHOUT_AUTHORIZATION",t[t.CROSSING_ENTRANCE_TIMEOUT=33]="CROSSING_ENTRANCE_TIMEOUT",t[t.CROSSING_EXIT_TIMEOUT=34]="CROSSING_EXIT_TIMEOUT",t[t.EXIT_NOT_CLEARED_TIMEOUT=35]="EXIT_NOT_CLEARED_TIMEOUT",t[t.GATE_ENTRY_TIMEOUT=36]="GATE_ENTRY_TIMEOUT",t[t.GATE_CROSSING_TIMEOUT=37]="GATE_CROSSING_TIMEOUT",t[t.MANTRAP_VALIDATION_TIMEOUT=38]="MANTRAP_VALIDATION_TIMEOUT",t[t.EXIT_AREA_CLEAR=39]="EXIT_AREA_CLEAR",t[t.EXIT_AREA_OCCUPIED=40]="EXIT_AREA_OCCUPIED",t[t.SELF_BOARDING_COMPLETE=41]="SELF_BOARDING_COMPLETE",t[t.NO_PASS_FIRST_SENSOR=42]="NO_PASS_FIRST_SENSOR",t[t.NO_PASS_LAST_SENSOR=43]="NO_PASS_LAST_SENSOR",t[t.BOARDING_CANCELED=44]="BOARDING_CANCELED",t[t.SENSOR_FAILURE=45]="SENSOR_FAILURE",t[t.FLAPS_FAILURE=46]="FLAPS_FAILURE",t[t.PAPER_RESTOCK=47]="PAPER_RESTOCK",t[t.SESSION_TIME=48]="SESSION_TIME",t[t.ALARM=49]="ALARM",t[t.EXIT_BLOCKED=50]="EXIT_BLOCKED",t[t.INCORRECT_GATE=51]="INCORRECT_GATE",t[t.GATE_OPEN=52]="GATE_OPEN",t[t.GATE_CLOSED=53]="GATE_CLOSED",t[t.GATE_AUTHORIZED=54]="GATE_AUTHORIZED",t[t.EMERGENCY=55]="EMERGENCY",t[t.MAINTENANCE=56]="MAINTENANCE",t[t.BOARDING_PASS_PREVIOUSLY_USED=57]="BOARDING_PASS_PREVIOUSLY_USED",t[t.GATE_INOPERABLE=58]="GATE_INOPERABLE",t[t.GATE_EMPLOYEE_AUTHORIZED=59]="GATE_EMPLOYEE_AUTHORIZED",t[t.FREESTATE=60]="FREESTATE",t[t.CONTROLSTATE=61]="CONTROLSTATE",t[t.PRMMODE=62]="PRMMODE",t[t.AIRLINE_PASS=63]="AIRLINE_PASS",t[t.BOARDING_PASS_PRINT=68]="BOARDING_PASS_PRINT",t[t.APPLICATION_AVAILABLE=69]="APPLICATION_AVAILABLE",t[t.APPLICATION_UNAVAILABLE=70]="APPLICATION_UNAVAILABLE",t[t.APPLICATION_ACTIVE=71]="APPLICATION_ACTIVE",t[t.APPLICATION_STOP=72]="APPLICATION_STOP",t[t.PASSPORT_SCANNED=73]="PASSPORT_SCANNED",t[t.BAGTAG_PRINTER_ONLINE=74]="BAGTAG_PRINTER_ONLINE",t[t.BAGTAG_PRINTER_OFFLINE=75]="BAGTAG_PRINTER_OFFLINE",t[t.BARCODE_READER_ONLINE=76]="BARCODE_READER_ONLINE",t[t.BARCODE_READER_OFFLINE=77]="BARCODE_READER_OFFLINE",t[t.PASSPORT_READER_ONLINE=78]="PASSPORT_READER_ONLINE",t[t.PASSPORT_READER_OFFLINE=79]="PASSPORT_READER_OFFLINE",t[t.BOARDINGPASS_PRINTER_ONLINE=90]="BOARDINGPASS_PRINTER_ONLINE",t[t.BOARDINGPASS_PRINTER_OFFLINE=91]="BOARDINGPASS_PRINTER_OFFLINE",t[t.BOARDINGPASS_PRINTER_PAPER_OUT=92]="BOARDINGPASS_PRINTER_PAPER_OUT",t[t.BOARDINGPASS_PRINTER_PAPER_LOW=93]="BOARDINGPASS_PRINTER_PAPER_LOW",t[t.BOARDINGPASS_PRINTER_PAPER_JAM=94]="BOARDINGPASS_PRINTER_PAPER_JAM",t[t.BOARDINGPASS_PRINTER_PAPER_RESTOCK=95]="BOARDINGPASS_PRINTER_PAPER_RESTOCK",t[t.BOARDINGPASS_PRINTER_FAILURE=96]="BOARDINGPASS_PRINTER_FAILURE",t[t.CONFIGURATION_REQUESTED=103]="CONFIGURATION_REQUESTED",t[t.CONFIGURATION_COMPLETED=110]="CONFIGURATION_COMPLETED",t[t.PASSENGER_CHECK_IN=104]="PASSENGER_CHECK_IN",t[t.PASSENGER_CHECK_IN_FAILED=105]="PASSENGER_CHECK_IN_FAILED",t[t.BAGTAG_PRINT_FAILURE=106]="BAGTAG_PRINT_FAILURE",t[t.APPLICATION_ACTIVE_ACCESSIBLE=108]="APPLICATION_ACTIVE_ACCESSIBLE",t[t.APPLICATION_INITIALIZE=109]="APPLICATION_INITIALIZE",t[t.CARDREADER_ONLINE=111]="CARDREADER_ONLINE",t[t.CARDREADER_OFFLINE=112]="CARDREADER_OFFLINE",t[t.CARDREADER_FAILURE=113]="CARDREADER_FAILURE",t[t.CARDREADER_READ=114]="CARDREADER_READ",t[t.ANNOUNCEMENT_ONLINE=115]="ANNOUNCEMENT_ONLINE",t[t.ANNOUNCEMENT_OFFLINE=116]="ANNOUNCEMENT_OFFLINE",t[t.KEYPAD_ONLINE=117]="KEYPAD_ONLINE",t[t.KEYPAD_OFFLINE=118]="KEYPAD_OFFLINE",t[t.ILLUMINATION_ONLINE=119]="ILLUMINATION_ONLINE",t[t.ILLUMINATION_OFFLINE=124]="ILLUMINATION_OFFLINE",t[t.HEADSET_ONLINE=125]="HEADSET_ONLINE",t[t.HEADSET_OFFLINE=126]="HEADSET_OFFLINE",t[t.FEEDER_ONLINE=127]="FEEDER_ONLINE",t[t.FEEDER_OFFLINE=128]="FEEDER_OFFLINE",t[t.DISPENSER_ONLINE=129]="DISPENSER_ONLINE",t[t.DISPENSER_OFFLINE=130]="DISPENSER_OFFLINE",t[t.NO_DOCV=131]="NO_DOCV",t[t.DOCS_VERIFIED_PRINTING_ALLOWED=132]="DOCS_VERIFIED_PRINTING_ALLOWED",t[t.GROUP_BOOKING_NOT_SUPPORTED=135]="GROUP_BOOKING_NOT_SUPPORTED",t[t.ERROR_GENERIC=400]="ERROR_GENERIC",t[t.USER_LOGIN=107]="USER_LOGIN",t[t.TEST_ENV=215]="TEST_ENV",t[t.AGENT_LOGIN_ACTIVATION=200]="AGENT_LOGIN_ACTIVATION",t[t.AGENT_LOGOUT_ACTIVATION=201]="AGENT_LOGOUT_ACTIVATION",t[t.PAX_ACTIVATION_TIME=202]="PAX_ACTIVATION_TIME",t[t.BAG_TAG_NOT_FOUND=204]="BAG_TAG_NOT_FOUND",t[t.EXPIRED_DRIVERS_LICENSE=205]="EXPIRED_DRIVERS_LICENSE",t[t.VALID_DRIVERS_LICENSE=206]="VALID_DRIVERS_LICENSE",t[t.NOT_PART_OF_RESERVATION=207]="NOT_PART_OF_RESERVATION",t[t.ID_MATCH_NOT_FOUND=208]="ID_MATCH_NOT_FOUND",t[t.BAG_ALREADY_ACTIVATED=209]="BAG_ALREADY_ACTIVATED",t[t.UNABLE_TO_ACTIVATE_BAG=210]="UNABLE_TO_ACTIVATE_BAG",t[t.INVALID_BAGTAG=216]="INVALID_BAGTAG",t[t.BOARDED=211]="BOARDED",t[t.BEGIN_BOARDING_FAILED=212]="BEGIN_BOARDING_FAILED",t[t.BOARDING_ENDED=213]="BOARDING_ENDED",t[t.BOARDING_FAILED=214]="BOARDING_FAILED",t[t.INVALID_BOARDING_PASS=217]="INVALID_BOARDING_PASS",t[t.FLIGHT_SCANNED_MISMATCH=218]="FLIGHT_SCANNED_MISMATCH",t[t.SCANNED_WITHOUT_STARTING=219]="SCANNED_WITHOUT_STARTING",t[t.BOARDING_STARTED=220]="BOARDING_STARTED",t[t.ZONING_ATTEMPT_FAILED=221]="ZONING_ATTEMPT_FAILED",t[t.ZONING_CHNAGE=222]="ZONING_CHNAGE",t[t.ZONING_TIME=223]="ZONING_TIME",t[t.FLIGHT_ROOM_JOINED=224]="FLIGHT_ROOM_JOINED",t[t.FLIGHT_ROOM_LEFT=225]="FLIGHT_ROOM_LEFT",t[t.MANIFEST_SUCCESS=226]="MANIFEST_SUCCESS",t[t.MANIFEST_ERROR=227]="MANIFEST_ERROR",t[t.SOCKET_COMMAND=228]="SOCKET_COMMAND",t[t.REQUEST_PROFILING=203]="REQUEST_PROFILING",t[t.FAILED_TO_READ_BAG_TAG=300]="FAILED_TO_READ_BAG_TAG",t[t.BAG_TAG_FOUND=301]="BAG_TAG_FOUND",t[t.BAG_SETTLED=302]="BAG_SETTLED",t[t.BAG_AT_ENTRY=303]="BAG_AT_ENTRY",t[t.BAG_IN_HOLDING_AREA=304]="BAG_IN_HOLDING_AREA",t[t.WAITING_ON_BHS=305]="WAITING_ON_BHS",t[t.INTRUSION_DETECTED=306]="INTRUSION_DETECTED",t[t.NO_BAG_DETECTED=307]="NO_BAG_DETECTED",t[t.TRYING_TO_ACQUIRE_BAG_TAG=308]="TRYING_TO_ACQUIRE_BAG_TAG",t[t.BAG_RELEASED=309]="BAG_RELEASED",t[t.MOVE_TO_HOLDING_AREA=310]="MOVE_TO_HOLDING_AREA",t[t.CANCEL_NEED_INTERVENTION=311]="CANCEL_NEED_INTERVENTION",t[t.CANCEL_PASSENGER_CAN_FIX=312]="CANCEL_PASSENGER_CAN_FIX",t[t.MULTIPLE_BAG_TAGS_ERROR=313]="MULTIPLE_BAG_TAGS_ERROR",t[t.MULTIPLE_BAGS_ERROR=314]="MULTIPLE_BAGS_ERROR",t[t.HOLDING_AREA_FULL=315]="HOLDING_AREA_FULL",t[t.BAG_CANNOT_RELEASE=316]="BAG_CANNOT_RELEASE",t[t.BAG_CANNOT_PROCESS=317]="BAG_CANNOT_PROCESS",t[t.CONVEY_BELT_INOPERABLE=318]="CONVEY_BELT_INOPERABLE",t[t.UNKNOWN_SBD_ERROR=319]="UNKNOWN_SBD_ERROR",t[t.BAG_OVER_LENGTH=320]="BAG_OVER_LENGTH",t[t.BAG_OVER_HEIGHT=321]="BAG_OVER_HEIGHT",t[t.BAG_JAMMED_INSIDE=322]="BAG_JAMMED_INSIDE",t[t.UNEXPECTED_BAG_IN_REAR=323]="UNEXPECTED_BAG_IN_REAR",t[t.BAG_TOO_FLAT=324]="BAG_TOO_FLAT",t[t.BAG_TOO_SHORT=325]="BAG_TOO_SHORT",t[t.BAG_OVERWEIGHT=326]="BAG_OVERWEIGHT",t[t.BAG_UNDERWEIGHT=327]="BAG_UNDERWEIGHT",t[t.BAG_NOT_SETTLED=328]="BAG_NOT_SETTLED",t[t.BAG_NOT_CONVEYABLE=329]="BAG_NOT_CONVEYABLE",t[t.BHS_OFFLINE=330]="BHS_OFFLINE",t[t.BHS_BUSY=331]="BHS_BUSY",t[t.FRONT_BAG_BLOCKING_REAR_RETURN=332]="FRONT_BAG_BLOCKING_REAR_RETURN",t[t.TECHNICAL_ERROR=333]="TECHNICAL_ERROR",t[t.BAG_UNEXPECTEDLY_REMOVED=334]="BAG_UNEXPECTEDLY_REMOVED",t))(he||{});var de=(f=>(f[f.CUSS=1]="CUSS",f[f.NONCUSS=2]="NONCUSS",f[f.SELF_BOARDING_MODE=5]="SELF_BOARDING_MODE",f[f.LOCKED_MODE=6]="LOCKED_MODE",f[f.OPEN_MODE=7]="OPEN_MODE",f[f.DEBOARDING_MODE=8]="DEBOARDING_MODE",f[f.EMERGENCY_MODE=9]="EMERGENCY_MODE",f[f.MAINTENANCE_MODE=10]="MAINTENANCE_MODE",f))(de||{});var be=(c=>(c[c.TAGGING_KIOSK=1]="TAGGING_KIOSK",c[c.CHECKIN_KIOSK=2]="CHECKIN_KIOSK",c[c.GATE=3]="GATE",c[c.ADMIN_PANEL=4]="ADMIN_PANEL",c[c.HUB=5]="HUB",c[c.CUSTOM_APP=6]="CUSTOM_APP",c[c.PLATFORM=7]="PLATFORM",c[c.PROXY=8]="PROXY",c[c.EXTERNAL_API=9]="EXTERNAL_API",c))(be||{});var Vr=(a=>(a[a.SUCCESS=200]="SUCCESS",a[a.MODE_CHANGE=300]="MODE_CHANGE",a[a.FAILURE=400]="FAILURE",a[a.CRITICAL_FAILURE=500]="CRITICAL_FAILURE",a[a.INFRACTION=501]="INFRACTION",a[a.TIMEOUT=502]="TIMEOUT",a))(Vr||{});var jr=(n=>(n.INFO="INFO",n.DELAYED="DELAYED",n.ERROR="ERROR",n.CRITICAL="CRITICAL",n))(jr||{});function ge(){return crypto.randomUUID()}var V=class{constructor(r,e){this.fn=r;this.delay=e}timeoutId=null;lastCall=0;call(...r){let e=Date.now();e-this.lastCall<this.delay||(this.timeoutId&&clearTimeout(this.timeoutId),this.lastCall=e,this.fn(...r))}async callAsync(...r){let e=Date.now();if(!(e-this.lastCall<this.delay))return this.timeoutId&&clearTimeout(this.timeoutId),this.lastCall=e,await this.fn(...r)}reset(){this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.lastCall=0}},_r=class{constructor(r=6e4,e=!0){this.ttl=r;e&&this.startAutoCleanup()}cache=new Map;cleanupInterval=null;set(r,e,i){let n=Date.now()+(i||this.ttl);this.cache.set(r,{value:e,expires:n})}get(r){let e=this.cache.get(r);if(e){if(Date.now()>e.expires){this.cache.delete(r);return}return e.value}}has(r){return this.get(r)!==void 0}delete(r){return this.cache.delete(r)}clear(){this.cache.clear()}startAutoCleanup(){this.cleanupInterval=setInterval(()=>{let r=Date.now();for(let[e,i]of this.cache.entries())r>i.expires&&this.cache.delete(e)},this.ttl)}destroy(){this.cleanupInterval&&(clearInterval(this.cleanupInterval),this.cleanupInterval=null),this.clear()}};function Wr(o=new Date){return o.toISOString()}var g=class{coreInfo=null;configured=!1;headers=new Headers;config(r){this.validateCoreInfo(r),this.coreInfo=r,this.setupHeaders(),this.configured=!0}validateCoreInfo(r){if(!r.token)throw new Error("Token is required in CoreInfo");if(!r.serviceEndpoint)throw new Error("Service endpoint is required in CoreInfo")}setupHeaders(){this.coreInfo&&(this.headers=new Headers({"Elevated-Auth":btoa(this.coreInfo.token)}))}checkConfiguration(){if(!this.configured||!this.coreInfo)throw new Error("Service not configured. Call config() first with CoreInfo")}async makeRequest(r,e={}){this.checkConfiguration();let i=`${this.coreInfo.serviceEndpoint}${r}`,n=this.coreInfo.timeout||3e4,s=new AbortController,a=setTimeout(()=>s.abort(),n);try{let u=await fetch(i,{...e,headers:{...Object.fromEntries(this.headers.entries()),...Object.fromEntries(new Headers(e.headers||{}).entries())},signal:s.signal});if(clearTimeout(a),!u.ok)throw new Error(`HTTP error! status: ${u.status}`);return{success:!0,data:await u.json()}}catch(u){return clearTimeout(a),u instanceof Error?u.name==="AbortError"?{success:!1,error:"Request timeout",message:`Request timed out after ${n}ms`}:{success:!1,error:u.message}:{success:!1,error:"Unknown error occurred"}}}async post(r,e){return this.makeRequest(r,{method:"POST",body:JSON.stringify(e)})}async patch(r,e){return this.makeRequest(r,{method:"PATCH",body:JSON.stringify(e)})}async get(r,e){return this.makeRequest(r,{method:"GET",headers:e})}async put(r,e){return this.makeRequest(r,{method:"PUT",body:JSON.stringify(e)})}async delete(r){return this.makeRequest(r,{method:"DELETE"})}};var K=class extends g{defaults={};debouncedEvents=new Map;setDefaults(r){this.defaults={...r},r.debounceEvent&&r.debounceEvent.forEach(({eventCode:e,debounce:i})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:i,once:!1})}),r.debounceOnce&&r.debounceOnce.forEach(({eventCode:e,debounce:i})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:i,once:!0})})}shouldDebounce(r){let e=this.debouncedEvents.get(r);if(!e)return!1;let i=Date.now();return i-e.lastSent<e.debounceTime?!0:(e.lastSent=i,e.once&&this.debouncedEvents.delete(r),!1)}async send(r,e=null){this.checkConfiguration();let i={eventType:this.defaults.eventType,eventMode:this.defaults.eventMode,ownerID:this.defaults.ownerID,created:new Date,...r,eventData:r.eventData||{}};if(!i.metaData){let n={};i.eventCode&&(n.eventCode=i.eventCode),i.eventData&&i.eventData.airline&&(n.airline=i.eventData.airline),i.eventData&&i.eventData.countryCode&&(n.countryCode=i.eventData.countryCode),i.ownerID&&(n.ownerID=i.ownerID),e&&(n.tags=e.tags||[],n.location=e.location||null,n.testDevice=!!e.metadata.testDevice),i.metaData=n}if(i.eventCode&&this.shouldDebounce(i.eventCode))return{success:!0,message:"Event debounced"};try{return await this.post("/events",i)}catch(n){return console.error("Failed to send event:",n),{success:!1,error:"Failed to send event"}}}async success(r){return this.send({...r,statusCode:200})}async failure(r){return this.send({...r,statusCode:400})}async error(r){return this.send({...r,statusCode:400})}async critical(r){return this.send({...r,statusCode:500})}async infraction(r){return this.send({...r,statusCode:501})}async timeout(r){return this.send({...r,statusCode:502})}async modeChange(r){return this.send({...r,statusCode:300})}addDebounce(r){r.forEach(({eventCode:e,debounce:i})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:i,once:!1})})}addDebounceOnce(r){r.forEach(({eventCode:e,debounce:i})=>{this.debouncedEvents.set(e,{eventCode:e,lastSent:0,debounceTime:i,once:!0})})}clearDebounce(){this.debouncedEvents.clear()}reset(){this.clearDebounce(),this.defaults={}}},Ir=new K;var z=class extends g{defaults={};debouncer;lastLogHash=new Map;setDefaults(r){this.defaults={...r},r.debounce&&(this.debouncer=new V(async e=>await this.sendLog(e),r.debounce))}createLogHash(r){return`${r.level}-${r.message}-${r.applicationName}-${r.statusCode}`}shouldDebounce(r){if(!this.defaults.debounce)return!1;let e=this.createLogHash(r),i=Date.now(),n=this.lastLogHash.get(e)||0;return i-n<this.defaults.debounce?!0:(this.lastLogHash.set(e,i),!1)}async message(r){this.checkConfiguration();let e={deviceId:this.defaults.deviceId||"",applicationName:this.defaults.applicationName,statusCode:this.defaults.statusCode,level:"INFO",...r,message:r.message||""};if(!e.deviceId)throw new Error("deviceId is required for logging");if(!e.message)throw new Error("message is required for logging");return this.shouldDebounce(e)?{success:!0,message:"Log debounced"}:await this.sendLog(e)}async sendLog(r){let e={...r,timestamp:Wr(),environment:Deno.env.get("DENO_ENV")||"production"};try{return await this.post(`${this.coreInfo?.serviceEndpoint}/logs`,e)}catch(i){return console.error("Failed to send log:",i),{success:!1,error:i instanceof Error?i.message:"Unknown error"}}}async information(r){return this.message({...r,level:"INFO"})}async delayed(r){return this.message({...r,level:"DELAYED"})}async error(r){return this.message({...r,level:"ERROR"})}async critical(r){return this.message({...r,level:"CRITICAL"})}async batch(r){this.checkConfiguration();try{let i=(await Promise.all(r.map(n=>this.message(n)))).filter(n=>!n.success);return i.length===0?{success:!0,message:`Successfully sent ${r.length} logs`}:{success:!1,error:`Failed to send ${i.length} of ${r.length} logs`,data:{failures:i}}}catch(e){return console.error("Failed to send batch logs:",e),{success:!1,error:e instanceof Error?e.message:"Unknown error"}}}clearDebounce(){this.lastLogHash.clear(),this.debouncer&&this.debouncer.reset()}reset(){this.clearDebounce(),this.defaults={},this.debouncer=void 0}getStats(){return{debounceActive:!!this.debouncer,cacheSize:this.lastLogHash.size,defaults:this.defaults}}},Ar=new z;var Or=function(o,r){return Or=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,i){e.__proto__=i}||function(e,i){for(var n in i)Object.prototype.hasOwnProperty.call(i,n)&&(e[n]=i[n])},Or(o,r)};function w(o,r){if(typeof r!="function"&&r!==null)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");Or(o,r);function e(){this.constructor=o}o.prototype=r===null?Object.create(r):(e.prototype=r.prototype,new e)}function $r(o,r,e,i){function n(s){return s instanceof e?s:new e(function(a){a(s)})}return new(e||(e=Promise))(function(s,a){function u(m){try{c(i.next(m))}catch(b){a(b)}}function f(m){try{c(i.throw(m))}catch(b){a(b)}}function c(m){m.done?s(m.value):n(m.value).then(u,f)}c((i=i.apply(o,r||[])).next())})}function X(o,r){var e={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return a.next=u(0),a.throw=u(1),a.return=u(2),typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function u(c){return function(m){return f([c,m])}}function f(c){if(i)throw new TypeError("Generator is already executing.");for(;a&&(a=0,c[0]&&(e=0)),e;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return e.label++,{value:c[1],done:!1};case 5:e.label++,n=c[1],c=[0];continue;case 7:c=e.ops.pop(),e.trys.pop();continue;default:if(s=e.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){e=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){e.label=c[1];break}if(c[0]===6&&e.label<s[1]){e.label=s[1],s=c;break}if(s&&e.label<s[2]){e.label=s[2],e.ops.push(c);break}s[2]&&e.ops.pop(),e.trys.pop();continue}c=r.call(o,e)}catch(m){c=[6,m],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function S(o){var r=typeof Symbol=="function"&&Symbol.iterator,e=r&&o[r],i=0;if(e)return e.call(o);if(o&&typeof o.length=="number")return{next:function(){return o&&i>=o.length&&(o=void 0),{value:o&&o[i++],done:!o}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")}function N(o,r){var e=typeof Symbol=="function"&&o[Symbol.iterator];if(!e)return o;var i=e.call(o),n,s=[],a;try{for(;(r===void 0||r-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){a={error:u}}finally{try{n&&!n.done&&(e=i.return)&&e.call(i)}finally{if(a)throw a.error}}return s}function v(o,r,e){if(e||arguments.length===2)for(var i=0,n=r.length,s;i<n;i++)(s||!(i in r))&&(s||(s=Array.prototype.slice.call(r,0,i)),s[i]=r[i]);return o.concat(s||Array.prototype.slice.call(r))}function P(o){return this instanceof P?(this.v=o,this):new P(o)}function qr(o,r,e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=e.apply(o,r||[]),n,s=[];return n=Object.create((typeof AsyncIterator=="function"?AsyncIterator:Object).prototype),u("next"),u("throw"),u("return",a),n[Symbol.asyncIterator]=function(){return this},n;function a(p){return function(x){return Promise.resolve(x).then(p,b)}}function u(p,x){i[p]&&(n[p]=function(h){return new Promise(function(L,k){s.push([p,h,L,k])>1||f(p,h)})},x&&(n[p]=x(n[p])))}function f(p,x){try{c(i[p](x))}catch(h){_(s[0][3],h)}}function c(p){p.value instanceof P?Promise.resolve(p.value.v).then(m,b):_(s[0][2],p)}function m(p){f("next",p)}function b(p){f("throw",p)}function _(p,x){p(x),s.shift(),s.length&&f(s[0][0],s[0][1])}}function Yr(o){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=o[Symbol.asyncIterator],e;return r?r.call(o):(o=typeof S=="function"?S(o):o[Symbol.iterator](),e={},i("next"),i("throw"),i("return"),e[Symbol.asyncIterator]=function(){return this},e);function i(s){e[s]=o[s]&&function(a){return new Promise(function(u,f){a=o[s](a),n(u,f,a.done,a.value)})}}function n(s,a,u,f){Promise.resolve(f).then(function(c){s({value:c,done:u})},a)}}function l(o){return typeof o=="function"}function F(o){var r=function(i){Error.call(i),i.stack=new Error().stack},e=o(r);return e.prototype=Object.create(Error.prototype),e.prototype.constructor=e,e}var J=F(function(o){return function(e){o(this),this.message=e?e.length+` errors occurred during unsubscription:
`+e.map(function(i,n){return n+1+") "+i.toString()}).join(`
  `):"",this.name="UnsubscriptionError",this.errors=e}});function j(o,r){if(o){var e=o.indexOf(r);0<=e&&o.splice(e,1)}}var G=function(){function o(r){this.initialTeardown=r,this.closed=!1,this._parentage=null,this._finalizers=null}return o.prototype.unsubscribe=function(){var r,e,i,n,s;if(!this.closed){this.closed=!0;var a=this._parentage;if(a)if(this._parentage=null,Array.isArray(a))try{for(var u=S(a),f=u.next();!f.done;f=u.next()){var c=f.value;c.remove(this)}}catch(h){r={error:h}}finally{try{f&&!f.done&&(e=u.return)&&e.call(u)}finally{if(r)throw r.error}}else a.remove(this);var m=this.initialTeardown;if(l(m))try{m()}catch(h){s=h instanceof J?h.errors:[h]}var b=this._finalizers;if(b){this._finalizers=null;try{for(var _=S(b),p=_.next();!p.done;p=_.next()){var x=p.value;try{Kr(x)}catch(h){s=s??[],h instanceof J?s=v(v([],N(s)),N(h.errors)):s.push(h)}}}catch(h){i={error:h}}finally{try{p&&!p.done&&(n=_.return)&&n.call(_)}finally{if(i)throw i.error}}}if(s)throw new J(s)}},o.prototype.add=function(r){var e;if(r&&r!==this)if(this.closed)Kr(r);else{if(r instanceof o){if(r.closed||r._hasParent(this))return;r._addParent(this)}(this._finalizers=(e=this._finalizers)!==null&&e!==void 0?e:[]).push(r)}},o.prototype._hasParent=function(r){var e=this._parentage;return e===r||Array.isArray(e)&&e.includes(r)},o.prototype._addParent=function(r){var e=this._parentage;this._parentage=Array.isArray(e)?(e.push(r),e):e?[e,r]:r},o.prototype._removeParent=function(r){var e=this._parentage;e===r?this._parentage=null:Array.isArray(e)&&j(e,r)},o.prototype.remove=function(r){var e=this._finalizers;e&&j(e,r),r instanceof o&&r._removeParent(this)},o.EMPTY=function(){var r=new o;return r.closed=!0,r}(),o}();var Tr=G.EMPTY;function Z(o){return o instanceof G||o&&"closed"in o&&l(o.remove)&&l(o.add)&&l(o.unsubscribe)}function Kr(o){l(o)?o():o.unsubscribe()}var A={onUnhandledError:null,onStoppedNotification:null,Promise:void 0,useDeprecatedSynchronousErrorHandling:!1,useDeprecatedNextContext:!1};var U={setTimeout:function(o,r){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];var n=U.delegate;return n?.setTimeout?n.setTimeout.apply(n,v([o,r],N(e))):setTimeout.apply(void 0,v([o,r],N(e)))},clearTimeout:function(o){var r=U.delegate;return(r?.clearTimeout||clearTimeout)(o)},delegate:void 0};function Q(o){U.setTimeout(function(){var r=A.onUnhandledError;if(r)r(o);else throw o})}function Sr(){}var zr=function(){return Rr("C",void 0,void 0)}();function Xr(o){return Rr("E",void 0,o)}function Jr(o){return Rr("N",o,void 0)}function Rr(o,r,e){return{kind:o,value:r,error:e}}var E=null;function M(o){if(A.useDeprecatedSynchronousErrorHandling){var r=!E;if(r&&(E={errorThrown:!1,error:null}),o(),r){var e=E,i=e.errorThrown,n=e.error;if(E=null,i)throw n}}else o()}function Zr(o){A.useDeprecatedSynchronousErrorHandling&&E&&(E.errorThrown=!0,E.error=o)}var W=function(o){w(r,o);function r(e){var i=o.call(this)||this;return i.isStopped=!1,e?(i.destination=e,Z(e)&&e.add(i)):i.destination=Ie,i}return r.create=function(e,i,n){return new R(e,i,n)},r.prototype.next=function(e){this.isStopped?Nr(Jr(e),this):this._next(e)},r.prototype.error=function(e){this.isStopped?Nr(Xr(e),this):(this.isStopped=!0,this._error(e))},r.prototype.complete=function(){this.isStopped?Nr(zr,this):(this.isStopped=!0,this._complete())},r.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this),this.destination=null)},r.prototype._next=function(e){this.destination.next(e)},r.prototype._error=function(e){try{this.destination.error(e)}finally{this.unsubscribe()}},r.prototype._complete=function(){try{this.destination.complete()}finally{this.unsubscribe()}},r}(G);var xe=Function.prototype.bind;function wr(o,r){return xe.call(o,r)}var ye=function(){function o(r){this.partialObserver=r}return o.prototype.next=function(r){var e=this.partialObserver;if(e.next)try{e.next(r)}catch(i){C(i)}},o.prototype.error=function(r){var e=this.partialObserver;if(e.error)try{e.error(r)}catch(i){C(i)}else C(r)},o.prototype.complete=function(){var r=this.partialObserver;if(r.complete)try{r.complete()}catch(e){C(e)}},o}(),R=function(o){w(r,o);function r(e,i,n){var s=o.call(this)||this,a;if(l(e)||!e)a={next:e??void 0,error:i??void 0,complete:n??void 0};else{var u;s&&A.useDeprecatedNextContext?(u=Object.create(e),u.unsubscribe=function(){return s.unsubscribe()},a={next:e.next&&wr(e.next,u),error:e.error&&wr(e.error,u),complete:e.complete&&wr(e.complete,u)}):a=e}return s.destination=new ye(a),s}return r}(W);function C(o){A.useDeprecatedSynchronousErrorHandling?Zr(o):Q(o)}function _e(o){throw o}function Nr(o,r){var e=A.onStoppedNotification;e&&U.setTimeout(function(){return e(o,r)})}var Ie={closed:!0,next:Sr,error:_e,complete:Sr};var B=function(){return typeof Symbol=="function"&&Symbol.observable||"@@observable"}();function rr(o){return o}function Qr(o){return o.length===0?rr:o.length===1?o[0]:function(e){return o.reduce(function(i,n){return n(i)},e)}}var d=function(){function o(r){r&&(this._subscribe=r)}return o.prototype.lift=function(r){var e=new o;return e.source=this,e.operator=r,e},o.prototype.subscribe=function(r,e,i){var n=this,s=Oe(r)?r:new R(r,e,i);return M(function(){var a=n,u=a.operator,f=a.source;s.add(u?u.call(s,f):f?n._subscribe(s):n._trySubscribe(s))}),s},o.prototype._trySubscribe=function(r){try{return this._subscribe(r)}catch(e){r.error(e)}},o.prototype.forEach=function(r,e){var i=this;return e=Cr(e),new e(function(n,s){var a=new R({next:function(u){try{r(u)}catch(f){s(f),a.unsubscribe()}},error:s,complete:n});i.subscribe(a)})},o.prototype._subscribe=function(r){var e;return(e=this.source)===null||e===void 0?void 0:e.subscribe(r)},o.prototype[B]=function(){return this},o.prototype.pipe=function(){for(var r=[],e=0;e<arguments.length;e++)r[e]=arguments[e];return Qr(r)(this)},o.prototype.toPromise=function(r){var e=this;return r=Cr(r),new r(function(i,n){var s;e.subscribe(function(a){return s=a},function(a){return n(a)},function(){return i(s)})})},o.create=function(r){return new o(r)},o}();function Cr(o){var r;return(r=o??A.Promise)!==null&&r!==void 0?r:Promise}function Ae(o){return o&&l(o.next)&&l(o.error)&&l(o.complete)}function Oe(o){return o&&o instanceof W||Ae(o)&&Z(o)}function Te(o){return l(o?.lift)}function I(o){return function(r){if(Te(r))return r.lift(function(e){try{return o(e,this)}catch(i){this.error(i)}});throw new TypeError("Unable to lift unknown Observable type")}}function D(o,r,e,i,n){return new Se(o,r,e,i,n)}var Se=function(o){w(r,o);function r(e,i,n,s,a,u){var f=o.call(this,e)||this;return f.onFinalize=a,f.shouldUnsubscribe=u,f._next=i?function(c){try{i(c)}catch(m){e.error(m)}}:o.prototype._next,f._error=s?function(c){try{s(c)}catch(m){e.error(m)}finally{this.unsubscribe()}}:o.prototype._error,f._complete=n?function(){try{n()}catch(c){e.error(c)}finally{this.unsubscribe()}}:o.prototype._complete,f}return r.prototype.unsubscribe=function(){var e;if(!this.shouldUnsubscribe||this.shouldUnsubscribe()){var i=this.closed;o.prototype.unsubscribe.call(this),!i&&((e=this.onFinalize)===null||e===void 0||e.call(this))}},r}(W);var re=F(function(o){return function(){o(this),this.name="ObjectUnsubscribedError",this.message="object unsubscribed"}});var y=function(o){w(r,o);function r(){var e=o.call(this)||this;return e.closed=!1,e.currentObservers=null,e.observers=[],e.isStopped=!1,e.hasError=!1,e.thrownError=null,e}return r.prototype.lift=function(e){var i=new ee(this,this);return i.operator=e,i},r.prototype._throwIfClosed=function(){if(this.closed)throw new re},r.prototype.next=function(e){var i=this;M(function(){var n,s;if(i._throwIfClosed(),!i.isStopped){i.currentObservers||(i.currentObservers=Array.from(i.observers));try{for(var a=S(i.currentObservers),u=a.next();!u.done;u=a.next()){var f=u.value;f.next(e)}}catch(c){n={error:c}}finally{try{u&&!u.done&&(s=a.return)&&s.call(a)}finally{if(n)throw n.error}}}})},r.prototype.error=function(e){var i=this;M(function(){if(i._throwIfClosed(),!i.isStopped){i.hasError=i.isStopped=!0,i.thrownError=e;for(var n=i.observers;n.length;)n.shift().error(e)}})},r.prototype.complete=function(){var e=this;M(function(){if(e._throwIfClosed(),!e.isStopped){e.isStopped=!0;for(var i=e.observers;i.length;)i.shift().complete()}})},r.prototype.unsubscribe=function(){this.isStopped=this.closed=!0,this.observers=this.currentObservers=null},Object.defineProperty(r.prototype,"observed",{get:function(){var e;return((e=this.observers)===null||e===void 0?void 0:e.length)>0},enumerable:!1,configurable:!0}),r.prototype._trySubscribe=function(e){return this._throwIfClosed(),o.prototype._trySubscribe.call(this,e)},r.prototype._subscribe=function(e){return this._throwIfClosed(),this._checkFinalizedStatuses(e),this._innerSubscribe(e)},r.prototype._innerSubscribe=function(e){var i=this,n=this,s=n.hasError,a=n.isStopped,u=n.observers;return s||a?Tr:(this.currentObservers=null,u.push(e),new G(function(){i.currentObservers=null,j(u,e)}))},r.prototype._checkFinalizedStatuses=function(e){var i=this,n=i.hasError,s=i.thrownError,a=i.isStopped;n?e.error(s):a&&e.complete()},r.prototype.asObservable=function(){var e=new d;return e.source=this,e},r.create=function(e,i){return new ee(e,i)},r}(d);var ee=function(o){w(r,o);function r(e,i){var n=o.call(this)||this;return n.destination=e,n.source=i,n}return r.prototype.next=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.next)===null||n===void 0||n.call(i,e)},r.prototype.error=function(e){var i,n;(n=(i=this.destination)===null||i===void 0?void 0:i.error)===null||n===void 0||n.call(i,e)},r.prototype.complete=function(){var e,i;(i=(e=this.destination)===null||e===void 0?void 0:e.complete)===null||i===void 0||i.call(e)},r.prototype._subscribe=function(e){var i,n;return(n=(i=this.source)===null||i===void 0?void 0:i.subscribe(e))!==null&&n!==void 0?n:Tr},r}(y);var vr=new d(function(o){return o.complete()});function te(o){return o&&l(o.schedule)}function Re(o){return o[o.length-1]}function oe(o){return te(Re(o))?o.pop():void 0}var er=function(o){return o&&typeof o.length=="number"&&typeof o!="function"};function tr(o){return l(o?.then)}function or(o){return l(o[B])}function ir(o){return Symbol.asyncIterator&&l(o?.[Symbol.asyncIterator])}function nr(o){return new TypeError("You provided "+(o!==null&&typeof o=="object"?"an invalid object":"'"+o+"'")+" where a stream was expected. You can provide an Observable, Promise, ReadableStream, Array, AsyncIterable, or Iterable.")}function we(){return typeof Symbol!="function"||!Symbol.iterator?"@@iterator":Symbol.iterator}var sr=we();function ar(o){return l(o?.[sr])}function cr(o){return qr(this,arguments,function(){var e,i,n,s;return X(this,function(a){switch(a.label){case 0:e=o.getReader(),a.label=1;case 1:a.trys.push([1,,9,10]),a.label=2;case 2:return[4,P(e.read())];case 3:return i=a.sent(),n=i.value,s=i.done,s?[4,P(void 0)]:[3,5];case 4:return[2,a.sent()];case 5:return[4,P(n)];case 6:return[4,a.sent()];case 7:return a.sent(),[3,2];case 8:return[3,10];case 9:return e.releaseLock(),[7];case 10:return[2]}})})}function fr(o){return l(o?.getReader)}function O(o){if(o instanceof d)return o;if(o!=null){if(or(o))return Ne(o);if(er(o))return ve(o);if(tr(o))return De(o);if(ir(o))return ie(o);if(ar(o))return Pe(o);if(fr(o))return Ee(o)}throw nr(o)}function Ne(o){return new d(function(r){var e=o[B]();if(l(e.subscribe))return e.subscribe(r);throw new TypeError("Provided object does not correctly implement Symbol.observable")})}function ve(o){return new d(function(r){for(var e=0;e<o.length&&!r.closed;e++)r.next(o[e]);r.complete()})}function De(o){return new d(function(r){o.then(function(e){r.closed||(r.next(e),r.complete())},function(e){return r.error(e)}).then(null,Q)})}function Pe(o){return new d(function(r){var e,i;try{for(var n=S(o),s=n.next();!s.done;s=n.next()){var a=s.value;if(r.next(a),r.closed)return}}catch(u){e={error:u}}finally{try{s&&!s.done&&(i=n.return)&&i.call(n)}finally{if(e)throw e.error}}r.complete()})}function ie(o){return new d(function(r){Le(o,r).catch(function(e){return r.error(e)})})}function Ee(o){return ie(cr(o))}function Le(o,r){var e,i,n,s;return $r(this,void 0,void 0,function(){var a,u;return X(this,function(f){switch(f.label){case 0:f.trys.push([0,5,6,11]),e=Yr(o),f.label=1;case 1:return[4,e.next()];case 2:if(i=f.sent(),!!i.done)return[3,4];if(a=i.value,r.next(a),r.closed)return[2];f.label=3;case 3:return[3,1];case 4:return[3,11];case 5:return u=f.sent(),n={error:u},[3,11];case 6:return f.trys.push([6,,9,10]),i&&!i.done&&(s=e.return)?[4,s.call(e)]:[3,8];case 7:f.sent(),f.label=8;case 8:return[3,10];case 9:if(n)throw n.error;return[7];case 10:return[7];case 11:return r.complete(),[2]}})})}function T(o,r,e,i,n){i===void 0&&(i=0),n===void 0&&(n=!1);var s=r.schedule(function(){e(),n?o.add(this.schedule(null,i)):this.unsubscribe()},i);if(o.add(s),!n)return s}function ur(o,r){return r===void 0&&(r=0),I(function(e,i){e.subscribe(D(i,function(n){return T(i,o,function(){return i.next(n)},r)},function(){return T(i,o,function(){return i.complete()},r)},function(n){return T(i,o,function(){return i.error(n)},r)}))})}function lr(o,r){return r===void 0&&(r=0),I(function(e,i){i.add(o.schedule(function(){return e.subscribe(i)},r))})}function ne(o,r){return O(o).pipe(lr(r),ur(r))}function se(o,r){return O(o).pipe(lr(r),ur(r))}function ae(o,r){return new d(function(e){var i=0;return r.schedule(function(){i===o.length?e.complete():(e.next(o[i++]),e.closed||this.schedule())})})}function ce(o,r){return new d(function(e){var i;return T(e,r,function(){i=o[sr](),T(e,r,function(){var n,s,a;try{n=i.next(),s=n.value,a=n.done}catch(u){e.error(u);return}a?e.complete():e.next(s)},0,!0)}),function(){return l(i?.return)&&i.return()}})}function pr(o,r){if(!o)throw new Error("Iterable cannot be null");return new d(function(e){T(e,r,function(){var i=o[Symbol.asyncIterator]();T(e,r,function(){i.next().then(function(n){n.done?e.complete():e.next(n.value)})},0,!0)})})}function fe(o,r){return pr(cr(o),r)}function ue(o,r){if(o!=null){if(or(o))return ne(o,r);if(er(o))return ae(o,r);if(tr(o))return se(o,r);if(ir(o))return pr(o,r);if(ar(o))return ce(o,r);if(fr(o))return fe(o,r)}throw nr(o)}function $(o,r){return r?ue(o,r):O(o)}function Dr(){for(var o=[],r=0;r<arguments.length;r++)o[r]=arguments[r];var e=oe(o);return $(o,e)}var le=F(function(o){return function(){o(this),this.name="EmptyError",this.message="no elements in sequence"}});function Pr(o,r){var e=typeof r=="object";return new Promise(function(i,n){var s=new R({next:function(a){i(a),s.unsubscribe()},error:n,complete:function(){e?i(r.defaultValue):n(new le)}});o.subscribe(s)})}function Er(o,r){return I(function(e,i){var n=0;e.subscribe(D(i,function(s){i.next(o.call(r,s,n++))}))})}function mr(o){return I(function(r,e){var i=null,n=!1,s;i=r.subscribe(D(e,void 0,void 0,function(a){s=O(o(a,mr(o)(r))),i?(i.unsubscribe(),i=null,s.subscribe(e)):n=!0})),n&&(i.unsubscribe(),i=null,s.subscribe(e))})}function Fr(o){o===void 0&&(o={});var r=o.connector,e=r===void 0?function(){return new y}:r,i=o.resetOnError,n=i===void 0?!0:i,s=o.resetOnComplete,a=s===void 0?!0:s,u=o.resetOnRefCountZero,f=u===void 0?!0:u;return function(c){var m,b,_,p=0,x=!1,h=!1,L=function(){b?.unsubscribe(),b=void 0},k=function(){L(),m=_=void 0,x=h=!1},me=function(){var H=m;k(),H?.unsubscribe()};return I(function(H,Hr){p++,!h&&!x&&L();var q=_=_??e();Hr.add(function(){p--,p===0&&!h&&!x&&(b=Lr(me,f))}),q.subscribe(Hr),!m&&p>0&&(m=new R({next:function(Y){return q.next(Y)},error:function(Y){h=!0,L(),b=Lr(k,n,Y),q.error(Y)},complete:function(){x=!0,L(),b=Lr(k,a),q.complete()}}),O(H).subscribe(m))})(c)}}function Lr(o,r){for(var e=[],i=2;i<arguments.length;i++)e[i-2]=arguments[i];if(r===!0){o();return}if(r!==!1){var n=new R({next:function(){n.unsubscribe(),o()}});return O(r.apply(void 0,v([],N(e)))).subscribe(n)}}function hr(o,r,e){var i=l(o)||r||e?{next:o,error:r,complete:e}:o;return i?I(function(n,s){var a;(a=i.subscribe)===null||a===void 0||a.call(i);var u=!0;n.subscribe(D(s,function(f){var c;(c=i.next)===null||c===void 0||c.call(i,f),s.next(f)},function(){var f;u=!1,(f=i.complete)===null||f===void 0||f.call(i),s.complete()},function(f){var c;u=!1,(c=i.error)===null||c===void 0||c.call(i,f),s.error(f)},function(){var f,c;u&&((f=i.unsubscribe)===null||f===void 0||f.call(i)),(c=i.finalize)===null||c===void 0||c.call(i)}))}):rr}var dr=class extends g{onConnected=new y;onDisconnect=new y;onConfigRequired=new y;onCommand=new y;onFlightInfo=new y;onRefresh=new y;onPrint=new y;onRestart=new y;onNavigate=new y;ws=null;reconnectTimer=null;pingTimer=null;reconnectAttempts=0;maxReconnectAttempts=10;reconnectDelay=1e3;iotInfo={appName:"ElevationDenoService"};isConnected=!1;shouldReconnect=!0;config(r,e){if(super.config(r),!r.iotEndpoint)throw new Error("iotEndpoint is required in CoreInfo for IOT service");if(!r.fingerPrint)throw new Error("fingerPrint is required in CoreInfo for IOT service");e&&(this.iotInfo=e),this.connect()}connect(){if(!(!this.coreInfo||!this.coreInfo.iotEndpoint))try{this.disconnect(!1);let r=new URL(this.coreInfo.iotEndpoint);r.searchParams.set("token",this.coreInfo.token),r.searchParams.set("fingerprint",this.coreInfo.fingerPrint),r.searchParams.set("appName",this.iotInfo.appName),r.searchParams.set("appVersion",this.iotInfo.appVersion||"1.0.0"),this.coreInfo.secondary&&r.searchParams.set("secondary","true"),this.ws=new WebSocket(r.toString()),this.ws.onopen=()=>this.handleOpen(),this.ws.onmessage=e=>this.handleMessage(e),this.ws.onclose=e=>this.handleClose(e),this.ws.onerror=e=>this.handleError(e)}catch(r){console.error("Failed to create WebSocket connection:",r),this.scheduleReconnect()}}handleOpen(){console.log("IOT WebSocket connected"),this.isConnected=!0,this.reconnectAttempts=0,this.send({type:"handshake",data:{fingerPrint:this.coreInfo.fingerPrint,appName:this.iotInfo.appName,appVersion:this.iotInfo.appVersion,secondary:this.coreInfo.secondary||!1}}),this.startPing()}handleMessage(r){try{let e=JSON.parse(r.data);switch(e.type){case"connected":this.onConnected.next();break;case"config_required":this.onConfigRequired.next();break;case"command":this.onCommand.next(e.data),this.parseSpecialCommands(e.data);break;case"flight_info":this.onFlightInfo.next(e.data);break;case"refresh":this.onRefresh.next();break;case"print":this.onPrint.next(e.data);break;case"pong":break;default:console.log("Unknown IOT message type:",e.type)}}catch(e){console.error("Failed to parse IOT message:",e)}}parseSpecialCommands(r){r.refresh&&this.onRefresh.next(),r.restart&&this.onRestart.next(),r.navigate&&this.onNavigate.next(r.navigate),r.print&&this.onPrint.next(r.print),r.flightInfo&&this.onFlightInfo.next(r.flightInfo)}handleClose(r){console.log("IOT WebSocket closed:",r.code,r.reason),this.isConnected=!1,this.onDisconnect.next(),this.stopPing(),this.shouldReconnect&&!r.wasClean&&this.scheduleReconnect()}handleError(r){console.error("IOT WebSocket error:",r)}scheduleReconnect(){if(this.reconnectTimer&&clearTimeout(this.reconnectTimer),this.reconnectAttempts>=this.maxReconnectAttempts){console.error("Max reconnection attempts reached");return}this.reconnectAttempts++;let r=Math.min(this.reconnectDelay*Math.pow(2,this.reconnectAttempts-1),3e4);console.log(`Reconnecting in ${r}ms (attempt ${this.reconnectAttempts})`),this.reconnectTimer=setTimeout(()=>{this.connect()},r)}startPing(){this.stopPing(),this.pingTimer=setInterval(()=>{this.ws&&this.ws.readyState===WebSocket.OPEN&&this.send({type:"ping"})},3e4)}stopPing(){this.pingTimer&&(clearInterval(this.pingTimer),this.pingTimer=null)}send(r){this.ws&&this.ws.readyState===WebSocket.OPEN&&this.ws.send(JSON.stringify(r))}sendCommand(r){this.send({type:"command",data:r})}sendEvent(r,e){this.send({type:"event",eventType:r,data:e})}disconnect(r=!1){this.shouldReconnect=r,this.reconnectTimer&&(clearTimeout(this.reconnectTimer),this.reconnectTimer=null),this.stopPing(),this.ws&&(this.ws.close(),this.ws=null),this.isConnected=!1}reconnect(){this.shouldReconnect=!0,this.reconnectAttempts=0,this.connect()}getStatus(){return{connected:this.isConnected,reconnectAttempts:this.reconnectAttempts,endpoint:this.coreInfo?.iotEndpoint}}destroy(){this.disconnect(!1)}},Gr=new dr;var br=class extends g{started=!1;config(r){if(super.config(r),!r.fingerPrint)throw new Error("fingerPrint is required in CoreInfo for Enrollment service")}async start(){this.checkConfiguration();let r=await this.get(`${this.coreInfo?.serviceEndpoint}/devices/key`);if(r.success&&r.data){let e=r.data[0];if(e.metadata?.configured)throw new Error("Device is already enrolled");return this.started=!0,e}throw new Error(r.error||"Failed to start enrollment")}async getLocations(){this.checkConfiguration();let r=await this.get(`${this.coreInfo?.serviceEndpoint}/locations`);if(r.success&&r.data)return r.data;throw new Error(r.error||"Failed to get locations")}async getSpecification(){this.checkConfiguration();let r=await this.get(`${this.coreInfo?.serviceEndpoint}/speficiations`);if(r.success&&r.data)return r.data;throw new Error(r.error||"Failed to get specifications")}async enrollDevice(r){if(this.checkConfiguration(),!this.started)throw new Error("start subscription first");if(!r.label)throw new Error("Device label is required");if(!r.device?._id)throw new Error("Missing Device information");if(!r.location?._id)throw new Error("Location is required");if(!r.terminal?._id)throw new Error("Terminal is required");if(!r.specification?.id)throw new Error("Specification is required");if(!await this.isLabelAvailable(r.label))throw new Error(`Device label '${r.label}' is already in use`);return r.device.label=r.label,r.device.location=r.location._id,r.device.terminal=r.terminal._id,r.specification&&(r.device.hardware={model:r.specification.model}),r.metadata&&(r.device.metadata=r.metadata),r.location?.configurations&&(r.device.configurations={...r.location.configurations,...r.device.configurations}),await this.patch(`${this.coreInfo?.serviceEndpoint}/devices/${r.device._id}`,r.device)}async isLabelAvailable(r){if(this.checkConfiguration(),!r)return!1;let e=await this.get(`${this.coreInfo?.serviceEndpoint}/devices/label/${r}`,{});return e.success&&e.data?e.data.length===0:!1}},Ur=new br;var gr=class extends g{configInfo=null;config(r,e){super.config(r),e&&this.setConfigInfo(e)}setConfigInfo(r){if(!r.deviceId||!r.locationId)throw new Error("Both deviceId and locationId are required in ElevatedConfigurationsInfo");this.configInfo=r}checkConfigInfo(){if(!this.configInfo)throw new Error("ElevatedConfigurationsInfo not set. Call setConfigInfo() first")}async getConfig(r){return this.checkConfiguration(),this.checkConfigInfo(),this.get(`${this.coreInfo?.serviceEndpoint}/configurations/${r}/${this.configInfo?.locationId}/${this.configInfo?.deviceId}`).then(e=>e.data||null).catch(e=>(console.error("Error fetching configuration:",e),null))}async getConfigs(r){return Promise.all(r.map(e=>this.getConfig(e)))}},Mr=new gr;var xr=class extends g{stringsObservable=null;cmsCache=new Map;allStrings=null;reqHeaderNoCache={"Cache-Control":"no-cache"};config(r){super.config(r),this.refreshInfo(r)}refreshInfo(r){super.config(r)}async getKey(r,e,i=!1,n=!0){if(this.checkConfiguration(),n&&this.allStrings?.length){let s=this.cmsCache.get(`${r}-${e}`),a=this.cmsCache.get(`${r}-en-US`),u=s!==void 0?s:a!==void 0?a:null;return i&&u?JSON.parse(u):u}if(!n||!this.allStrings?.length){try{await Pr(this.loadAllStrings(i))}catch(f){console.error("Failed to load strings for key lookup:",f)}let s=this.cmsCache.get(`${r}-${e}`),a=this.cmsCache.get(`${r}-en-US`),u=s!==void 0?s:a!==void 0?a:null;return i&&u?JSON.parse(u):u}return null}getString(r,e,i=!0){return this.getKey(r,e,!1,i)}getConfig(r,e,i=!0){return this.getKey(r,e,!0,i)}loadAllStrings(r=!1){return this.checkConfiguration(),!r&&this.stringsObservable?this.stringsObservable:!r&&this.allStrings&&this.allStrings.length>0?Dr(this.allStrings):(this.stringsObservable=$(this.get(`${this.coreInfo?.serviceEndpoint}/strings`,r?this.reqHeaderNoCache:void 0)).pipe(Er(e=>{if(!e.success||!e.data)throw new Error("Failed to load CMS strings");return e.data}),hr(e=>{this.allStrings=e,this.updateCacheFromStrings(this.allStrings)}),mr(e=>(console.error("Failed to load CMS strings:",e),this.stringsObservable=null,vr)),Fr(),hr({complete:()=>{setTimeout(()=>{this.stringsObservable=null},0)}})),this.stringsObservable)}getAllStrings(){return this.allStrings}clearCache(){this.cmsCache.clear()}getCacheStats(){return{size:this.cmsCache.size,keys:Array.from(this.cmsCache.keys())}}updateCacheFromStrings(r){for(let e of r)for(let[i,n]of Object.entries(e.languages)){let s=n.versions.find(a=>a.published)||n.versions[0];if(s){let a=`${e.element}-${i}`;this.cmsCache.set(a,s.string)}}}destroy(){this.clearCache(),this.allStrings=null}},Br=new xr;var yr=class extends g{touchPointId=null;getDeviceByFingerPrint(){if(this.checkConfiguration(),!this.coreInfo?.fingerPrint)throw new Error("Device fingerprint is required for TouchPoint service");return this.get(`${this.coreInfo?.serviceEndpoint}/devices/key/${this.coreInfo.fingerPrint}`).then(r=>{if(r.data?.length){let e=r.data[0];return e&&(this.touchPointId=e._id),e}return null}).catch(r=>(console.error(r),null))}async getInfo(){return this.getDeviceByFingerPrint()}async inService(r,e){if(this.checkConfiguration(),!this.coreInfo?.fingerPrint)throw new Error("Device fingerprint is required for TouchPoint service");try{if(this.touchPointId||await this.getDeviceByFingerPrint(),!this.touchPointId)return;await this.post(`${this.coreInfo.serviceEndpoint}/devices/service`,{id:this.touchPointId,state:r,reason:e})}catch(i){console.error(`Unable to transition to state: ${r} ${i}`)}}},kr=new yr;var pe=class{events=Ir;logs=Ar;iot=Gr;enrollment=Ur;config=Mr;cms=Br;touchPoint=kr;initialize(r){this.events.config(r),this.logs.config(r),this.enrollment.config(r),this.cms.config(r),this.touchPoint.config(r),r.iotEndpoint&&r.fingerPrint&&this.iot.config(r)}};export{xr as CMS,_r as Cache,V as Debouncer,gr as ElevatedConfigurations,br as ElevatedEnrollment,K as ElevatedEvents,dr as ElevatedIOT,z as ElevatedLogs,pe as ElevationService,he as EventCode,de as EventMode,be as EventType,jr as LogLevel,Vr as StatusCode,yr as TouchPoint,Br as cms,Mr as elevatedConfigurations,Ar as elogs,Ur as enrollment,Ir as events,Gr as iot,kr as touchPoint,ge as uuid};
//# sourceMappingURL=index.min.js.map
